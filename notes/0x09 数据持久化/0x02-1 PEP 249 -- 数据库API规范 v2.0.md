# PEP 249 -- æ•°æ®åº“APIè§„èŒƒ v2.0
> GitHub@[orca-j35](https://github.com/orca-j35)ï¼Œæ‰€æœ‰ç¬”è®°å‡æ‰˜ç®¡äº [python_notes](https://github.com/orca-j35/python_notes) ä»“åº“
>
> å‚è€ƒ:
>
> - https://www.python.org/dev/peps/pep-0249/
> - http://sinhub.cn/2019/01/pep249-in-chinese/

## ä»‹ç»

PEP 249 æ˜¯ Python æ•°æ®åº“ API è§„èŒƒçš„ 2.0 ç‰ˆæœ¬ï¼ŒPEP 248 æ˜¯ 1.0 ç‰ˆæœ¬ã€‚PEP 249 ä¸ä»…åŒ…å« Python æ•°æ®åº“ API è§„èŒƒï¼Œè¿˜æè¿°äº†ä¸€ç»„å…·å¤‡é€šç”¨æ€§çš„å¯é€‰æ‰©å±•ã€‚æ—©å…ˆçš„ 1.0 ç‰ˆæœ¬(PEP 248)ä¾ç„¶å…·å¤‡å‚è€ƒä»·å€¼ï¼Œä½†é¼“åŠ±æ¨¡å—ç¼–å†™è€…åœ¨å¼€å‘æ–°æ¥å£æ—¶ä»¥ PEP 249 ä¸ºå‚è€ƒã€‚PEP 249 çš„ç›®æ ‡æ˜¯è®©"æ•°æ®åº“è®¿é—®æ¨¡å—"æä¾›ç›¸ä¼¼çš„æ¥å£ï¼Œå®ç°ä¸€è‡´æ€§ï¼Œä»è€Œè®©ä»£ç ä¾¿äºç§»æ¤ã€‚

å¦‚æœéœ€è¦äº†è§£ä¸æ•°æ®åº“æ¥å£ç›¸å…³çš„å„ç§åº“ï¼Œè¯·çœ‹ [Database Topic Guide](http://www.python.org/topics/database/)ã€‚

## æ¨¡å—æ¥å£

### æ„é€ å™¨

æœ¬è§„èŒƒçº¦å®šï¼Œéœ€é€šè¿‡ Connection å¯¹è±¡æ¥è®¿é—®æ•°æ®åº“ï¼Œå› æ­¤"æ•°æ®åº“è®¿é—®æ¨¡å—"å¿…é¡»æä¾›ç”¨æ¥åˆ›å»º Connection å¯¹è±¡çš„æ„é€ å™¨ã€‚

#### connectğŸª“

ğŸª“connect( *parameters...* )

è¯¥æ„é€ å™¨ç”¨äºåˆ›å»ºæ•°æ®åº“è¿æ¥ï¼Œè¿”å›å€¼æ˜¯ Connection å¯¹è±¡ã€‚

*parameters...* è¡¨ç¤ºä¸æ•°æ®åº“ç›¸å…³çš„å‚æ•°ã€‚

> æ³¨é‡Š:
>
> æ„é€ å™¨ connect( *parameters...* ) çš„å‚æ•°åº”ä»¥å…³é”®å­—å‚æ•°çš„å½¢å¼å®ç°ï¼Œå¹¶æŒ‰ç…§ä¸‹è¡¨ä¸­çš„å…ˆåé¡ºåºæ’åˆ—:
>
> | Parameter  | Meaning                        |
> | :--------- | :----------------------------- |
> | `dsn`      | Data source name as string     |
> | `user`     | User name as string (optional) |
> | `password` | Password as string (optional)  |
> | `host`     | Hostname (optional)            |
> | `database` | Database name (optional)       |
>
> E.g. a connect could look like this:
>
> ```
> connect(dsn='myhost:MYDB', user='guido', password='234$')
> ```



### æ¨¡å—çº§å…¨å±€å˜é‡

æ•°æ®åº“è®¿é—®æ¨¡å—å¿…é¡»å®šä¹‰æœ¬èŠ‚ä¸­ç»™å‡ºçš„å„ç§å…¨å±€å˜é‡

#### apilevelğŸ”§

ğŸ”§apilevel

ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œè¡¨ç¤ºæ¨¡å—æ”¯æŒçš„ DB API ç‰ˆæœ¬ã€‚

ç›®å‰åªå…è®¸ä½¿ç”¨å­—ç¬¦ä¸² "1.0" (å¯¹åº” PEP 248) å’Œ "2.0" (å¯¹åº” PEP 249)ã€‚å¦‚æœæœªç»™å‡ºè¯¥å¸¸é‡ï¼Œåˆ™å‡è®¾æ¨¡å—ä½¿ç”¨ DB-API 1.0ã€‚



#### threadsafetyğŸ”§

ğŸ”§threadsafety

ä¸€ä¸ªæ•´æ•°å¸¸é‡ï¼Œç”¨äºè¯´æ˜æ¨¡å—æ¥å£æ”¯æŒçš„çº¿ç¨‹å®‰å…¨çº§åˆ«ï¼Œå¯é€‰å€¼å¦‚ä¸‹:

| threadsafety | Meaning                                                |
| :----------- | :----------------------------------------------------- |
| 0            | Threads may not share the module.                      |
| 1            | Threads may share the module, but not connections.     |
| 2            | Threads may share the module and connections.          |
| 3            | Threads may share the module, connections and cursors. |

share æ„å‘³ç€ä¸¤ä¸ªçº¿ç¨‹åœ¨ä½¿ç”¨åŒä¸€ä¸ªèµ„æºæ—¶ï¼Œæ— éœ€ä½¿ç”¨äº’æ–¥ä¿¡å·(*mutex* *semaphore*)æ¥å®ç°èµ„æºé”ã€‚æ³¨æ„ï¼Œå³ä½¿å·²ä½¿ç”¨äº’é”æœºåˆ¶(*mutex*)æ¥ç®¡ç†è®¿é—®æƒé™ï¼Œä¹Ÿæ— æ³•å§‹ç»ˆç¡®ä¿å¤–éƒ¨èµ„æºçš„çº¿ç¨‹å®‰å…¨: å› ä¸ºå¤–éƒ¨èµ„æºå¯èƒ½ä¼šä¾èµ–äºå…¨å±€å˜é‡ï¼Œæˆ–ä¾èµ–äºä½ æ— æ³•æ§åˆ¶çš„å…¶å®ƒå¤–éƒ¨èµ„æºã€‚



#### paramstyleğŸ”§

ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œç”¨äºè¯´æ˜æ¨¡å—æ¥å£æœŸæœ›çš„å‚æ•°æ ‡è®°(*parameter* *marker*)çš„æ ¼å¼åŒ–é£æ ¼ï¼Œå¯é€‰å€¼å¦‚ä¸‹:

| paramstyle | Meaning                                                     |
| :--------- | :---------------------------------------------------------- |
| `qmark`    | Question mark style, e.g. `...WHERE name=?`                 |
| `numeric`  | Numeric, positional style, e.g. `...WHERE name=:1`          |
| `named`    | Named style, e.g. `...WHERE name=:name`                     |
| `format`   | ANSI C printf format codes, e.g. `...WHERE name=%s`         |
| `pyformat` | Python extended format codes, e.g. `...WHERE name=%(name)s` |

æ¨¡å—å®ç°è€…åº”ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ `numeric`, `named` æˆ– `pyformat`ï¼Œå› ä¸ºå®ƒä»¬æ¸…æ™°åº¦å’Œçµæ´»æ€§æ›´ä½³ã€‚

```python
import sqlite3
print(sqlite3.paramstyle) #> qmark

import pymysql
print(pymysql.paramstyle) #> pyformat

import mysql.connector
print(mysql.connector.paramstyle) #> pyformat
```

å¯è§ï¼Œ`sqlite3` ä½¿ç”¨ `?` ä½œä¸ºå‚æ•°æ ‡è®°ï¼Œå› æ­¤å¯ä½¿ç”¨ä»¥ä¸‹è¯­å¥æ’å…¥æ•°æ®:

```python
cursor.execute("INSERT INTO user (id,name) VALUES (?, ?)", (6, 'liuyi'))
```

### Exceptions

æ•°æ®åº“è®¿é—®æ¨¡å—åº”é€šè¿‡ä¸‹è¿° Exception ç±»(æˆ–å…¶å­ç±»)æ¥æä¾›å…¨éƒ¨é”™è¯¯ä¿¡æ¯:

- â˜£`Warning`

  å¿…é¡»ç»§æ‰¿è‡ª Python `StandardError`ï¼Œé‡åˆ°ä¸‹è¿°ç±»ä¼¼æƒ…å†µæ—¶ï¼Œåº”æŠ›å‡ºè¯¥å¼‚å¸¸:

  - åœ¨æ’å…¥æ—¶é‡åˆ°æ•°æ®è¢«æˆªæ–­

- â˜£`Error`

  å¿…é¡»ç»§æ‰¿è‡ª Python `StandardError`ï¼Œæ¨¡å—ä¸­å…¶å®ƒæ‰€æœ‰ error å¼‚å¸¸éƒ½åº”æ˜¯ `Error` çš„å­ç±»ã€‚ä½ å¯ä»¥åœ¨å•ä¸ª `except` è¯­å¥ä¸­ä½¿ç”¨ `Error` æ¥æ•æ‰æ‰€æœ‰ error å¼‚å¸¸ã€‚`Warning` ä¸åº”è¢«è§†ä¸º errorï¼Œå› æ­¤ä¸æ˜¯ `Error` çš„å­ç±»ã€‚

- â˜£`InterfaceError` 

  å¿…é¡»æ˜¯ `Error` çš„å­ç±»è¡¨ç¤ºé‚£äº›ä¸æ•°æ®åº“æ¥å£æœ‰å…³ï¼Œè€Œä¸æ•°æ®åº“æœ¬èº«æ— å…³çš„é”™è¯¯ã€‚

- â˜£`DatabaseError` 

  å¿…é¡»æ˜¯ `Error` çš„å­ç±»ï¼Œè¡¨ç¤ºé‚£äº›ä¸æ•°æ®åº“æœ‰å…³çš„é”™è¯¯ã€‚

- â˜£`DataError`

  å¿…é¡»æ˜¯ `DatabaseError` çš„å­ç±»ï¼Œè¡¨ç¤ºå› å¤„ç†æ•°æ®è€Œå¯¼è‡´çš„é”™è¯¯ï¼Œä¾‹å¦‚: é™¤æ•°æ˜¯ 0ï¼›æˆ–æ•°å€¼è¶…å‡ºèŒƒå›´

- â˜£`OperationalError`

  å¿…é¡»æ˜¯ `DatabaseError` çš„å­ç±»ï¼Œè¡¨ç¤ºä¸æ•°æ®åº“æ“ä½œç›¸å…³çš„é”™è¯¯ï¼Œå¹¶ä¸”ä¸ä¸€å®šæ˜¯åœ¨ç¨‹åºå‘˜çš„æ§åˆ¶ä¹‹ä¸‹é€ æˆçš„é”™è¯¯ã€‚æ¯”å¦‚ï¼Œæ„å¤–æƒ…å†µå¯¼è‡´æ–­å¼€è¿æ¥ï¼›æ‰¾ä¸åˆ°æ•°æ®æºåç§°ï¼›æ— æ³•å¤„ç†äº‹åŠ¡ï¼Œå¤„ç†æœŸé—´å‘ç”Ÿå†…å­˜åˆ†é…é”™è¯¯ç­‰

- â˜£`IntergrityError`

  å¿…é¡»æ˜¯ `DatabaseError` çš„å­ç±»ï¼Œè¡¨ç¤ºæ•°æ®æ“ä½œè¿åäº†æ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸã€‚æ¯”å¦‚ï¼Œå¤–é”®æ£€æŸ¥å¤±è´¥ã€‚

- â˜£`InternalError`

  å¿…é¡»æ˜¯ `DatabaseError` çš„å­ç±»ï¼Œé‡åˆ°æ•°æ®åº“å†…éƒ¨é”™è¯¯æ—¶ä¼šæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚æ¯”å¦‚ï¼Œæ¸¸æ ‡(*cursor*)ä¸å†æœ‰æ•ˆï¼Œæˆ–äº‹åŠ¡ä¸åŒæ­¥ç­‰ã€‚

- â˜£`ProgrammingError`

  å¿…é¡»æ˜¯ `DatabaseError` çš„å­ç±»ï¼Œè¡¨ç¤ºç¨‹åºé€»è¾‘å‡ºé”™ã€‚æ¯”å¦‚ï¼Œæœªæ‰¾åˆ°è¡¨æˆ–è¡¨å·²ç»å­˜åœ¨ï¼›SQL è¯­å¥ä¸­çš„è¯­æ³•é”™è¯¯ï¼›æŒ‡å®šäº†é”™è¯¯çš„å‚æ•°æ•°é‡ç­‰ã€‚

- â˜£`NotSupportedError`

  å¿…é¡»æ˜¯ `DatabaseError` çš„å­ç±»ï¼Œå½“ä½¿ç”¨äº†æ•°æ®åº“ä¸æ”¯æŒçš„ API æˆ–æ–¹æ³•æ—¶ä¼šæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸æ”¯æŒ SQL äº‹åŠ¡(æˆ–å·²å…³é—­äº‹åŠ¡)çš„ connection ä¸Šè¯·æ±‚ `.rollback()` æ–¹æ³•ã€‚




#### ç»§æ‰¿ç»“æ„

ä¸‹é¢æ˜¯ Exception ç±»çš„ç»§æ‰¿ç»“æ„:

```
StandardError
|__Warning
|__Error
   |__InterfaceError
   |__DatabaseError
      |__DataError
      |__OperationalError
      |__IntegrityError
      |__InternalError
      |__ProgrammingError
      |__NotSupportedError
```

> âš The values of these exceptions are not defined. They should give the user a fairly good idea of what went wrong, though.

### Connection å¯¹è±¡

Connection å¯¹è±¡å¿…é¡»å®ç°æœ¬èŠ‚ä¸­ç»™å‡ºçš„å„ç§æ–¹æ³•ã€‚

#### Connection æ–¹æ³•

##### .close()ğŸ”¨

ç«‹å³å…³é—­è¿æ¥(è€Œä¸æ˜¯æ¯æ¬¡éƒ½è°ƒç”¨ `.__del__()` æ–¹æ³•)

åœ¨ Connection å¯¹è±¡ä¸Šè°ƒç”¨ `.close()` åï¼Œ"è¿æ¥"å°†ä¸å†å¯ç”¨ã€‚å¦‚æœè¯•å›¾å¯¹æ­¤"è¿æ¥"åšä»»ä½•æ“ä½œéƒ½ä¼šæŠ›å‡º `Error` (æˆ–å…¶å­ç±»)å¼‚å¸¸ã€‚è¿™åŒæ ·é€‚ç”¨äºè¯•å›¾ä½¿ç”¨æ­¤"è¿æ¥"çš„æ‰€æœ‰æ¸¸æ ‡(*cursor*)å¯¹è±¡ã€‚

âš å¦‚æœæ²¡æœ‰ commit å˜æ›´å°±å…³é—­äº†"è¿æ¥"ï¼Œå°†éšå¼æ‰§è¡Œ rollback æ“ä½œã€‚



##### .commit()ğŸ”¨

å°†ä»»ä½•æŒ‚èµ·çš„äº‹åŠ¡(*transaction*)æäº¤åˆ°æ•°æ®åº“ã€‚

âš å¦‚æœæ•°æ®åº“æ”¯æŒè‡ªåŠ¨æäº¤(*auto*-*commit*)åŠŸèƒ½ï¼Œå¿…é¡»å…ˆå…³é—­è‡ªåŠ¨æäº¤åŠŸèƒ½ã€‚è¿˜å¯ä»¥æä¾›ä¸€ä¸ªæ¥å£æ–¹æ³•æ¥é‡æ–°å¼€å¯è‡ªåŠ¨æäº¤åŠŸèƒ½ã€‚

å¦‚æœæ•°æ®åº“æ¨¡å—ä¸æ”¯æŒäº‹åŠ¡ï¼Œåˆ™åº”ä½¿ç”¨ä¸€ä¸ªç©ºæ–¹æ³•(*void* *functionality*)æ¥å®ç° `.commit()`



##### .rollback()ğŸ”¨

è¿™æ˜¯ä¸€ä¸ªå¯é€‰æ–¹æ³•ï¼Œå› ä¸ºå¹¶éæ‰€æœ‰æ•°æ®åº“éƒ½æ”¯æŒäº‹åŠ¡ã€‚

å¦‚æœæ•°æ®åº“ç¡®å®æ”¯æŒäº‹åŠ¡ï¼Œ`.rollback()` æ–¹æ³•ä¼šä½¿æ•°æ®åº“å›æ»šåˆ°ä»»ä½•æŒ‚èµ·äº‹åŠ¡çš„ä¹‹å‰ã€‚å¦‚æœæ²¡æœ‰ commit å˜æ›´å°±å…³é—­äº†"è¿æ¥"ï¼Œå°†éšå¼æ‰§è¡Œ rollback æ“ä½œã€‚

> æ³¨é‡Š:
>
> If the database does not support the functionality required by the method, the interface should throw an exception in case the method is used.
>
> The preferred approach is to not implement the method and thus have Python generate an `AttributeError` in case the method is requested. This allows the programmer to check for database capabilities using the standard `hasattr()` function.
>
> For some dynamically configured interfaces it may not be appropriate to require dynamically making the method available. These interfaces should then raise a`NotSupportedError` to indicate the non-ability to perform the roll back when the method is invoked.

##### .cursor()ğŸ”¨

ä½¿ç”¨ Connection å¯¹è±¡è¿”å›ä¸€ä¸ªæ–°çš„ Cursor å¯¹è±¡ã€‚

å¦‚æœæ•°æ®åº“å¹¶æ²¡æœ‰ç›´æ¥æä¾›æ¸¸æ ‡çš„æ¦‚å¿µï¼Œåˆ™æ¨¡å—å¿…é¡»ä½¿ç”¨å…¶ä»–æ–¹å¼æ¥æ¨¡æ‹Ÿè§„èŒƒæ‰€éœ€çš„â€œæ¸¸æ ‡â€ã€‚

> æ•°æ®åº“æ¥å£å¯ä»¥é€‰æ‹©æ˜¯å¦ä¸º `.cursor()` æä¾›ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°æ¥æ„å»ºå…·å cursorã€‚è¯¥åŠŸèƒ½å¹¶ä¸å±äºè§„èŒƒä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒä¼šä½¿ `.fetch*()` æ–¹æ³•çš„è¯­ä¹‰å¤æ‚åŒ–ã€‚



### Cursor å¯¹è±¡

Cursor å¯¹è±¡è¡¨ç¤ºæ•°æ®åº“çš„æ¸¸æ ‡(*cursor*)ï¼Œç”¨äºç®¡ç† fetch æ“ä½œçš„ä¸Šä¸‹æ–‡(*context*)ã€‚ç”±åŒä¸€ä¸ª connection åˆ›å»ºçš„ cursor ä¹‹é—´å¹¶ä¸æ˜¯å­¤ç«‹çš„(*isolated*)ï¼ŒæŸä¸ª cursor å¯¹æ•°æ®åº“è¿›è¡Œçš„ä»»ä½•æ”¹åŠ¨éƒ½ä¼šè¢«å…¶å®ƒ cursor ç«‹å³çœ‹åˆ°ã€‚ç”±ä¸åŒ connection åˆ›å»ºçš„ cursor ä¹‹é—´å¯èƒ½æ˜¯ç›¸äº’å­¤ç«‹çš„ï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯ç›¸äº’å­¤ç«‹çš„ï¼Œè¿™å–å†³äºäº‹åŠ¡æ”¯æŒçš„å®ç°æ–¹å¼ã€‚(è¿˜å¯ä»¥çœ‹çœ‹ connection çš„ `rollback()` å’Œ `.commit()` æ–¹æ³•)

Cursor å¯¹è±¡å¿…é¡»å®ç°æœ¬èŠ‚ä¸­ç»™å‡ºçš„å„ç§æ–¹æ³•å’Œå±æ€§ã€‚



#### Cursor å±æ€§

##### .descriptionğŸ”§

è¯¥åªè¯»å±æ€§æœ¬èº«æ˜¯ä¸€ä¸ªåºåˆ—ï¼Œåºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ åˆå¯¹åº”ä¸ºä¸€ä¸ªå­åºåˆ—ï¼Œå­åºåˆ—ç”±ä»¥ä¸‹ 7 ä¸ªæ¡ç›®ç»„æˆã€‚å­åºåˆ—ä¸­å­˜æ”¾ç€å¯¹ç»“æœåˆ—(*column*)çš„æè¿°ä¿¡æ¯ï¼Œæ¯ä¸ªå­åºåˆ—å¯¹åº”ä¸€ä¸ªç»“æœåˆ—ã€‚

- `name`
- `type_code` - æ­¤åˆ—åœ¨æ•°æ®åº“ä¸­çš„ç±»å‹
- `display_size`
- `internal_size`
- `precision`
- `scale`
- `null_ok`

å‰ä¸¤ä¸ªæ¡ç›®(`name` å’Œ `type_coe`)æ˜¯å¿…å¡«é¡¹ï¼Œåé¢äº”ä¸ªæ˜¯é€‰å¡«é¡¹ã€‚å¦‚æœä¸èƒ½æä¾›æœ‰æ„ä¹‰çš„å€¼ï¼Œåˆ™è®¾ç½®ä¸º `None`ã€‚

åœ¨é‡åˆ°ä»¥ä¸‹ä¸¤ç§æƒ…å†µæ—¶ï¼Œ`.description` çš„å€¼æ˜¯ `None`:

- curcor å°šæœªé€šè¿‡ `.execute*()` æ–¹æ³•æ‰§è¡Œæ“ä½œ
- è¢«æ‰§è¡Œçš„æ“ä½œä¸ä¼šè¿”å›ä»»ä½•è¡Œ(*row*)

å¦‚æœéœ€è¦äº†è§£ `type_code` çš„å«ä¹‰ï¼Œè¯·å‚è€ƒ Type Objects å°èŠ‚



##### .rowcountğŸ”§

è¯¥åªè¯»å±æ€§ç”¨äºå­˜æ”¾ä»¥ä¸‹ä¸¤ç§æƒ…å†µæ¶‰åŠåˆ°çš„è¡Œæ•°:

- æœ€è¿‘ä¸€æ¬¡ `.execute*()` è°ƒç”¨æ‰€å¾—ç»“æœçš„è¡Œæ•°( é’ˆå¯¹ SELECT ç­‰ DQL è¯­å¥)
- æœ€è¿‘ä¸€æ¬¡ `.execute*()` è°ƒç”¨æ‰€å½±å“çš„è¡Œæ•°( é’ˆå¯¹ UPDATE æˆ– INSERT ç­‰ DML è¯­å¥)

> æ³¨é‡Š:
>
> The term *number of affected rows* generally refers to the number of rows deleted, updated or inserted by the last statement run on the database cursor. Most databases will return the total number of rows that were found by the corresponding `WHERE` clause of the statement. Some databases use a different interpretation for `UPDATE`s and only return the number of rows that were changed by the `UPDATE`, even though the `WHERE` clause of the statement may have found more matching rows. Database module authors should try to implement the more common interpretation of returning the total number of rows found by the `WHERE` clause, or clearly document a different interpretation of the `.rowcount` attribute.

åœ¨é‡åˆ°ä»¥ä¸‹ä¸¤ç§æƒ…å†µæ—¶ï¼Œ`.rowcount` çš„å€¼ä¸º `-1`:

- cursor å°šæœªæ‰§è¡Œè¿‡ `.execute*()` æ–¹æ³•

- æ¥å£æ— æ³•ç¡®å®šæœ€åä¸€æ¬¡æ“ä½œçš„æ¶‰åŠåˆ°çš„è¡Œæ•°

  åœ¨ä»Šåçš„ DB API è§„èŒƒä¸­ä¼šé‡æ–°å®šä¹‰æ­¤ç§æƒ…å†µï¼Œå°†è¿”å›å€¼ç”± `-1` æ”¹ä¸º `None`

> The `rowcount` attribute may be coded in a way that updates its value dynamically. This can be useful for databases that return usable `rowcount` values only after the first call to a [.fetch*()](https://www.python.org/dev/peps/pep-0249/#id19) method.

##### .arraysizeğŸ”§

ğŸ”§.arraysize

è¯¥å¯è¯»/å†™å±æ€§è¡¨ç¤ºæ¯æ¬¡è°ƒç”¨ `fetchmany()` æ—¶å¯è·å–åˆ°çš„ç»“æœé›†ä¸­çš„è¡Œæ•°ã€‚è¯¥å­—æ®µçš„é»˜è®¤å€¼æ˜¯ `1`ï¼Œæ„å‘³ç€æ¯æ¬¡è°ƒç”¨ `fetchmany()` å‡½æ•°ä¼šè·å–ç»“æœé›†ä¸­çš„ä¸€è¡Œæ•°æ®ã€‚

åœ¨å®ç° `.fetchmany()` æ—¶å¿…é¡»éµå®ˆ `.arraysize` å­—æ®µï¼Œä½†åœ¨å®ç°è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥ä¸€æ¬¡ä¸€è¡Œçš„å’Œæ•°æ®åº“äº¤äº’ã€‚åœ¨å®ç° `executemany()` æ–¹æ³•æ—¶ï¼Œä¹Ÿå¯ä½¿ç”¨ `.arrarsize` å­—æ®µã€‚



#### Cursor æ–¹æ³•

##### .callproc()ğŸ”¨

ğŸ”¨.callproc( *procname* [, *parameters* ] )

(æ­¤æ–¹æ³•æ˜¯å¯é€‰å®ç°ï¼Œå› ä¸ºå¹¶éæ‰€æœ‰æ•°æ®åº“éƒ½æ”¯æŒ"å­˜å‚¨è¿‡ç¨‹(*stored* *procedures*)")

> æ³¨é‡Š:
>
> If the database does not support the functionality required by the method, the interface should throw an exception in case the method is used.
>
> The preferred approach is to not implement the method and thus have Python generate an `AttributeError` in case the method is requested. This allows the programmer to check for database capabilities using the standard `hasattr()` function.
>
> For some dynamically configured interfaces it may not be appropriate to require dynamically making the method available. These interfaces should then raise a`NotSupportedError` to indicate the non-ability to perform the roll back when the method is invoked.

â“Q: ä»€ä¹ˆæ˜¯"å­˜å‚¨è¿‡ç¨‹"?  A: å¯å‚è€ƒã€ŠSQL å¿…çŸ¥å¿…ä¼šã€‹->ç¬¬19è¯¾ ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹

`.callproc()` çš„åŠŸèƒ½æ˜¯è°ƒç”¨åä¸º *procname* çš„"å­˜å‚¨è¿‡ç¨‹"ï¼Œå‚æ•°åºåˆ— *parameters* ä¸­åŒ…å«çš„æ¡ç›®ä¾¿æ˜¯"å­˜å‚¨è¿‡ç¨‹"æ‰€éœ€çš„å‚æ•°ã€‚è°ƒç”¨ç»“æœå°†è¢«è¡¨ç¤ºä¸ºè¾“å…¥åºåˆ—çš„å‰¯æœ¬ï¼Œå¹¶åœ¨è¿”å›å‰å¯¹å‚æ•°è¿›è¡Œä¿®æ”¹:

- "å­˜å‚¨è¿‡ç¨‹"çš„è¾“å…¥(`IN`)å‚æ•°ä¿æŒä¸å˜
- è¾“å‡º(`OUT`)å‚æ•°å’Œè¾“å…¥/è¾“å‡º(`INOUT`)å‚æ•°å°†è¢«æ›¿æ¢ä¸ºå¯èƒ½çš„æ–°å€¼

"å­˜å‚¨è¿‡ç¨‹"ä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ªä½œä¸ºè¾“å‡ºçš„ç»“æœé›†ã€‚æ­¤æ—¶å¿…é¡»é€šè¿‡æ ‡å‡†çš„ `.fetch*()` æ–¹æ³•æ¥è·å–ã€‚

ğŸ“æŸäº›åº“çš„å®ç°æ–¹å¼å¯èƒ½å¹¶ä¸å…¼å®¹æœ¬æ¡çº¦å®šï¼Œæ¯”å¦‚ `pymysql`:

```python
"""Defining the Stored Routine in MySQL:
CREATE PROCEDURE multiply(IN pFac1 INT, IN pFac2 INT, OUT pProd INT)
BEGIN
SET pProd := pFac1 * pFac2;
END
"""
import pymysql
try:
    conn = pymysql.connect(
        host="localhost",
        port=3306,
        user='root',
        password='orca_j35',
        database='test',
    )
    cursor = conn.cursor()
    args = (5, 5, 0)
    # callproc()ç›´æ¥è¿”å›è¾“å…¥åºåˆ—,ä¸å…¼å®¹æœ¬æ¡çº¦å®š
    print(cursor.callproc('multiply', args))  #> (5, 5, 0)
    print(cursor.execute('SELECT @_multiply_2'))  #> 1
    print(cursor.fetchall()) #> ((25,),)
except Exception as ex:
    print(ex)
```



##### .close()ğŸ”¨

ğŸ”¨.close()

ç«‹å³å…³é—­ cursor (è€Œä¸æ˜¯æ¯æ¬¡éƒ½è°ƒç”¨ `.__del__()` æ–¹æ³•)

åœ¨ cursor å¯¹è±¡ä¸Šè°ƒç”¨ `.close()` åï¼Œcursor å°†ä¸åœ¨å¯ç”¨ã€‚å¦‚æœä¹‹åè¯•å›¾ä½¿ç”¨è¿™ä¸ª cursor æ‰§è¡Œä»»ä½•æ“ä½œï¼Œéƒ½ä¼šå¼•å‘ä¸€ä¸ª `Error` æˆ–å…¶ï¼ˆå­ç±»ï¼‰çš„å¼‚å¸¸ã€‚



##### .execute()ğŸ”¨

ğŸ”¨.execute(*operation* [, *parameters*])

å‡†å¤‡å¹¶æ‰§è¡Œä¸€ä¸ªæ•°æ®åº“æ“ä½œ: query æˆ– command

*parameters* å¯ä»¥æ˜¯åºåˆ—æˆ–æ˜ å°„ï¼Œ*parameters* ä¸­çš„å…ƒç´ å°†è¢«ç»‘å®šåˆ°æ“ä½œ *operation* å†…å«çš„å˜é‡ä¸­ã€‚éœ€ä»¥æ•°æ®åº“ç‰¹å®šçš„æ ‡è¯†ç¬¦æ¥è¡¨ç¤ºå˜é‡(è¯¦è§ `paramstyle` å±æ€§)

> æ³¨é‡Š:
>
> The module will use the `__getitem__` method of the *parameters* object to map either positions (integers) or names (strings) to parameter values. This allows for both sequences and mappings to be used as input.
>
> The term *bound* refers to the process of binding an input value to a database execution buffer. In practical terms, this means that the input value is directly used as a value in the operation. The client should not be required to "escape" the value so that it can be used â€” the value should be equal to the actual database value.

cursor å°†ä¿ç•™(*retain*)å¯¹ *operation* çš„å¼•ç”¨ã€‚å¦‚æœå†æ¬¡ä¼ å…¥ç›¸åŒçš„ *operation* å¯¹è±¡ï¼Œé‚£ä¹ˆ cursor å¯ä»¥ä¼˜åŒ–è¿™ç§è¡Œä¸ºã€‚è¿™å¯¹äºé‚£ç§(å¤šæ¬¡)ä½¿ç”¨ç›¸åŒçš„ *operation*ï¼Œä½†ä¼šå°†ä¸åŒ *parameters* ç»‘å®šåˆ°è¯¥ *operation* çš„æƒ…å†µæœ€æœ‰æ•ˆã€‚

ä¸ºäº†åœ¨é‡ç”¨ *operation* æ—¶è·å¾—æœ€å¤§çš„æ•ˆç‡ï¼Œæœ€å¥½ä½¿ç”¨ `.setinputsizes()` æ–¹æ³•æå‰æŒ‡å®š *parameters* ä¸­å„å‚æ•°çš„ç±»å‹å’Œå¤§å°ã€‚å‚æ•°ä¸é¢„å®šä¹‰ä¿¡æ¯ä¸åŒ¹é…ä¹Ÿå±äºåˆæ³•è¡Œä¸ºï¼Œä½†åœ¨å®ç°ä¸Šåº”è€ƒè™‘å¯¹å¯èƒ½ä¼šå‡ºç°çš„æ•ˆç‡æŸå¤±è¿›è¡Œè¡¥å¿(*compensate*)ã€‚

*parameters* ä¹Ÿå¯ä»¥æ˜¯å…ƒç»„åˆ—è¡¨(*list* *of* *tuples*)ï¼Œä¾‹å¦‚ï¼Œåœ¨å•ä¸ªæ“ä½œä¸­æ’å…¥å¤šè¡Œã€‚ä½†æ˜¯ä¸æ¨èè¿™ç§åšæ³•: åº”ä½¿ç”¨ `.executemany()` æ–¹æ³•ã€‚

æ­¤æ–¹æ³•æœªå®šä¹‰è¿”å›å€¼ã€‚

ç¤ºä¾‹ - 

```python
import pymysql
print(pymysql.paramstyle) #> pyformat
conn = pymysql.connect(
        host="localhost",
        port=3306,
        user='root',
        password='orca_j35',
        database='test',
    )
cursor = conn.cursor()
cursor.execute("INSERT INTO user(name) VALUES (%s)", ('å°åˆ˜', ))
cursor.execute('SELECT name,id FROM user Where name=%s', ('å°åˆ˜', ))
print(cursor.fetchall())
#> (('å°åˆ˜', 15),)
```



##### .executemany()ğŸ”¨

ğŸ”¨.executemany( *operation*, *seq_of_parameters* )

å‡†å¤‡ä¸€ä¸ªæ•°æ®åº“æ“ä½œ(query æˆ– command)ï¼Œç„¶åé€ä¸€ä½¿ç”¨ *seq_of_parameters* ä¸­åŒ…å«çš„åºåˆ—æˆ–æ˜ å°„æ¥æ‰§è¡Œè¯¥æ•°æ®åº“æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`.executemany()` æ–¹æ³•å¯ä»¥åœ¨ä¸€æ¬¡è°ƒç”¨ä¸­å¤„ç† *seq_of_parameters* ä¸­çš„æ‰€æœ‰åºåˆ—ã€‚

æ•°æ®åº“æ¨¡å—æœ‰ä¸¤ç§å®ç° `.executemany()` çš„æ–¹å¼:

- ç¬¬ä¸€ç§æ˜¯å¤šæ¬¡è°ƒç”¨ `.execute()` æ–¹æ³•
- ç¬¬äºŒç§æ˜¯ä½¿ç”¨æ•°ç»„æ“ä½œ(*array* *operations*)

å¦‚æœ `.executemany()` æ‰§è¡Œäº†ä¼šç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªç»“æœé›†(*result* *sets*)çš„ *operation*ï¼Œä¾¿ä¼šæ„æˆæœªå®šä¹‰è¡Œä¸ºï¼›å½“æ£€æµ‹åˆ°é€šè¿‡è°ƒç”¨æ“ä½œåˆ›å»ºäº†ç»“æœé›†æ—¶ï¼Œå…è®¸(éå¿…é¡»)å®ç°æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚

é€‚ç”¨äº `.execute()` çš„æ³¨é‡Šä¹Ÿé€‚ç”¨äºæ­¤æ–¹æ³•ã€‚

æ­¤æ–¹æ³•æœªå®šä¹‰è¿”å›å€¼ã€‚



##### .fetchone()ğŸ”¨

ğŸ”¨.fetchone()

è·å–"æŸ¥è¯¢ç»“æœé›†(*query* *result* *set*)"ä¸­çš„ä¸‹ä¸€è¡Œï¼Œå¹¶å°†å…¶è¡¨ç¤ºä¸ºå•ä¸ªåºåˆ—ã€‚å¦‚æœæ²¡æœ‰æ›´å¤šå¯ç”¨æ•°æ®åˆ™ä¼šè¿”å› `None`ã€‚

> æ³¨é‡Š:
>
> æ•°æ®åº“æ¥å£å¯èƒ½ä¼šä½¿ç”¨æ•°ç»„å’Œå…¶ä»–ä¼˜åŒ–æ–¹å¼æ¥å®ç°æ•°æ®è¡Œçš„è·å–ã€‚å› æ­¤åœ¨è°ƒç”¨ `fetchone()` æ—¶ï¼Œå¹¶ä¸èƒ½ä¿è¯ç›¸åº”çš„ cursor åªä¼šå‘å‰ç§»åŠ¨ä¸€è¡Œï¼Œå¯èƒ½ä¼šç§»åŠ¨å¤šè¡Œã€‚

å¦‚æœå…ˆå‰è°ƒç”¨çš„ `.execute*()` æ–¹æ³•å¹¶æœªäº§ç”Ÿä»»ä½•ç»“æœé›†ï¼Œæˆ–è€…å°šæœªè°ƒç”¨ `.execute*()`ï¼Œåˆ™åº”æŠ›å‡º `Error`(æˆ–å…¶å­ç±»)å¼‚å¸¸ã€‚



##### .fetchmany()ğŸ”¨

ğŸ”¨.fetchmany([*size*=cursor.arraysize])

å‘åè·å–æŸ¥è¯¢ç»“æœé›†ä¸­çš„å¤šä¸ªè¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«å„è¡Œæ•°æ®çš„åºåˆ—(e.g. a list of tuples)ï¼Œæ¯ä¸€è¡Œæ•°æ®ä¼šè¢«è¡¨ç¤ºä¸ºä¸€ä¸ªå­åºåˆ—ã€‚å½“ç»“æœé›†ä¸­æ²¡æœ‰æ›´å¤šå¯ç”¨è¡Œæ—¶ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªç©ºåºåˆ—ã€‚

æ¯æ¬¡è°ƒç”¨æ‰€è·å–çš„è¡Œæ•°ç”± *size* å‚æ•°å†³å®šã€‚å¦‚æœæ²¡æœ‰ä¼ å…¥ *size* å‚æ•°ï¼Œåˆ™ç”± cursor çš„ `arraysize ` å±æ€§æ¥ç¡®å®šè¦è·å–çš„è¡Œæ•°ã€‚è¯¥æ–¹æ³•åº”å°½åŠ›å°è¯•è·å– *size* è¡Œæ•°æ®ï¼Œå¦‚æœç»“æœé›†ä¸­çš„å¯ç”¨è¡Œæ•°å°äº *size*ï¼Œåˆ™è¿”å›çš„å‡½æ•°å¯èƒ½å°‘äº *size*ã€‚

å¦‚æœå…ˆå‰è°ƒç”¨çš„ `.execute*()` æ–¹æ³•å¹¶æœªäº§ç”Ÿä»»ä½•ç»“æœé›†ï¼Œæˆ–è€…å°šæœªè°ƒç”¨ `.execute*()`ï¼Œåˆ™åº”æŠ›å‡º `Error`(æˆ–å…¶å­ç±»)å¼‚å¸¸ã€‚

âš : *size* å‚æ•°çš„å¤§å°ä¼šå½±å“æ€§èƒ½ã€‚ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œé€šå¸¸æœ€å¥½å°† cursor çš„ `arraysize ` å±æ€§ç”¨ä½œ *size* çš„å€¼ã€‚å¦‚æœä½¿ç”¨è‡ªå®šä¹‰ *size* å€¼ï¼Œé‚£ä¹ˆæœ€å¥½åœ¨æ¯æ¬¡è°ƒç”¨ `.fetchmany()` æ—¶éƒ½ä½¿ç”¨ç›¸åŒçš„ *size* å€¼ã€‚



##### .fetchall()ğŸ”¨

ğŸ”¨.fetchall()

è·å–æŸ¥è¯¢ç»“æœé›†ä¸­æ‰€æœ‰(å‰©ä½™)çš„è¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«å„è¡Œæ•°æ®çš„åºåˆ—(e.g. a list of tuples)ï¼Œæ¯ä¸€è¡Œæ•°æ®ä¼šè¢«è¡¨ç¤ºä¸ºä¸€ä¸ªå­åºåˆ—ã€‚

âš cursor çš„ `arraysize` å±æ€§å¯èƒ½ä¼šå½±å“æ­¤æ“ä½œçš„æ€§èƒ½ã€‚

å¦‚æœå…ˆå‰è°ƒç”¨çš„ `.execute*()` æ–¹æ³•å¹¶æœªäº§ç”Ÿä»»ä½•ç»“æœé›†ï¼Œæˆ–è€…å°šæœªè°ƒç”¨ `.execute*()`ï¼Œåˆ™åº”æŠ›å‡º `Error`(æˆ–å…¶å­ç±»)å¼‚å¸¸ã€‚



##### .nextset()ğŸ”¨

ğŸ”¨.nextset()

(æ­¤æ–¹æ³•æ˜¯å¯é€‰å®ç°ï¼Œå› ä¸ºå¹¶éæ‰€æœ‰æ•°æ®åº“éƒ½æ”¯æŒ"å¤šç»“æœé›†(*multiple* *result* *sets*)")

> æ³¨é‡Š:
>
> If the database does not support the functionality required by the method, the interface should throw an exception in case the method is used.
>
> The preferred approach is to not implement the method and thus have Python generate an `AttributeError` in case the method is requested. This allows the programmer to check for database capabilities using the standard `hasattr()` function.
>
> For some dynamically configured interfaces it may not be appropriate to require dynamically making the method available. These interfaces should then raise a`NotSupportedError` to indicate the non-ability to perform the roll back when the method is invoked.

æ­¤æ–¹æ³•ä¼šä½¿ cursor è·³è‡³ä¸‹ä¸€ä¸ªå¯ç”¨çš„ç»“æœé›†ï¼Œå¹¶ä¸¢å¼ƒå½“å‰ç»“æœé›†ä¸­å‰©ä½™çš„æ‰€æœ‰è¡Œã€‚

å¦‚æœä¸å­˜åœ¨æ›´å¤šçš„ç»“æœé›†ï¼Œè¯¥æ–¹æ³•å°†è¿”å› `None`ï¼›å¦åˆ™ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªçœŸå€¼ï¼Œåœ¨è¿™ä¹‹åè°ƒç”¨çš„ `.fetch()` æ–¹æ³•å°†è¿”å›ä¸‹ä¸€ä¸ªç»“æœé›†ä¸­çš„è¡Œã€‚

å¦‚æœå…ˆå‰è°ƒç”¨çš„ `.execute*()` æ–¹æ³•å¹¶æœªäº§ç”Ÿä»»ä½•ç»“æœé›†ï¼Œæˆ–è€…å°šæœªè°ƒç”¨ `.execute*()`ï¼Œåˆ™åº”æŠ›å‡º `Error`(æˆ–å…¶å­ç±»)å¼‚å¸¸ã€‚

```python
"""åœ¨MySQLä¸­å®šä¹‰ä¸€ä¸ªè¿”å›å¤šç»“æœé›†çš„å­˜å‚¨è¿‡ç¨‹:
CREATE DEFINER=`root`@`localhost` PROCEDURE `multi_select`()
BEGIN
	SELECT name FROM `user`;
	SELECT id FROM `user`;
END
"""
"""userè¡¨ä¸­çš„æ•°æ®å¦‚ä¸‹:
 name |  id
"å°æ˜" | "1"
"å°çº¢" | "2"
"å°åˆš" | "3"
"å°ç¿" | "4"
"""
import pymysql
conn = pymysql.connect(
        host="localhost",
        port=3306,
        user='root',
        password='orca_j35',
        database='test',
    )
cursor = conn.cursor()
cursor.callproc('multi_select')
print(cursor.fetchone())
if cursor.nextset():
    print(cursor.fetchall())
```

è¾“å‡º:

```
('å°æ˜',)
((1,), (2,), (3,), (4,))
```



##### .setinputsizes()ğŸ”¨

ğŸ”¨.setinputsizes(*sizes*)

> .execute(*operation* [, *parameters*])
>
> .executemany( *operation*, *seq_of_parameters* )

åœ¨è°ƒç”¨ `.execute*()` ä¹‹å‰ï¼Œå¯ä½¿ç”¨è¯¥æ–¹æ³•é¢„å®šä¹‰ `.execute*()` çš„"æ“ä½œå‚æ•°"(*parameters* æˆ– *seq_of_parameters*)çš„å†…å­˜åŒºåŸŸã€‚

*sizes* å‚æ•°åº”æ˜¯ä¸€ä¸ªåºåˆ—ï¼Œè¯¥åºåˆ—ä¸­çš„é¡¹åº”å’Œ"è¾“å…¥å‚æ•°"ä¸­çš„é¡¹ç›¸äº’å¯¹åº”ï¼Œå¹¶ä¸”æ˜¯ç›¸åŒçš„ `Type Object` æˆ–è€…æ˜¯è¡¨ç¤ºå­—ç¬¦ä¸²å‚æ•°çš„æœ€å¤§é•¿åº¦çš„æ•´æ•°ã€‚å¦‚æœæŸä¸€é¡¹çš„å€¼æ˜¯ `None`ï¼Œåˆ™ä¸ä¼šä¸ºè¯¥åˆ—ä¿ç•™é¢„å®šä¹‰çš„å†…å­˜åŒºåŸŸâ€”â€”è¿™æ ·å¯ä»¥é¿å…ä¸ºå¤§å°ºå¯¸çš„"è¾“å…¥å‚æ•°"é¢„ç•™è¿‡å¤§çš„å†…å­˜åŒºåŸŸã€‚

åº”åœ¨ä½¿ç”¨ `.execte*()` ä¹‹å‰è°ƒç”¨ `.setinputsizes()`ã€‚

æ•°æ®åº“æ¨¡å—çš„å®ç°è€…å¯ä»¥è‡ªç”±é€‰æ‹©æ˜¯å¦å®ç°æ­¤æ–¹æ³•ï¼Œå¹¶ä¸”æ¨¡å—çš„ä½¿ç”¨è€…ä¹Ÿå¯ä»¥è‡ªç”±é€‰æ‹©æ˜¯å¦ä½¿ç”¨æ­¤æ–¹æ³•ã€‚

##### .setoutputsize()ğŸ”¨

ğŸ”¨.setoutputsize(*size* [, *column*])

ä¸ºè·å–"å¤§æ•°æ®åˆ—"(e.g. `LONG`s, `BLOB`s, etc.)è€Œè®¾ç½®çš„åˆ—ç¼“å†²åŒºã€‚*column* å‚æ•°ç”¨äºæŒ‡å®šç›®æ ‡åˆ—åœ¨ç»“æœåºåˆ—ä¸­çš„ç´¢å¼•ä½ç½®ã€‚å¦‚æœä¸è®¾ç½® *column*ï¼Œåˆ™é»˜è®¤ä¸º cursor ä¸­çš„å…¨éƒ¨å¤§æ•°æ®åˆ—è®¾ç½®å°ºå¯¸ä¸º *size* çš„ç¼“å†²åŒºã€‚

åº”åœ¨ä½¿ç”¨ `.execte*()` ä¹‹å‰è°ƒç”¨ `.setoutputsize()`ã€‚

æ•°æ®åº“æ¨¡å—çš„å®ç°è€…å¯ä»¥è‡ªç”±é€‰æ‹©æ˜¯å¦å®ç°æ­¤æ–¹æ³•ï¼Œå¹¶ä¸”æ¨¡å—çš„ä½¿ç”¨è€…ä¹Ÿå¯ä»¥è‡ªç”±é€‰æ‹©æ˜¯å¦ä½¿ç”¨æ­¤æ–¹æ³•ã€‚

## æ„é€ å‡½æ•°

è®¸å¤šæ•°æ®åº“éƒ½éœ€è¦å…·å¤‡ç‰¹å®šæ ¼å¼çš„è¾“å…¥ï¼Œä»¥ä¾¿é€šè¿‡ SQL æ“ä½œå°†è¾“å…¥å‚æ•°ç»‘å®šåˆ°æ•°æ®åº“ä¸­ã€‚ä¾‹å¦‚ï¼Œå‡å¦‚è¦å‘æ•°æ®åº“çš„ `DATE` åˆ—è¾“å…¥æ•°æ®ï¼Œå°±å¿…é¡»ä»¥"ç‰¹å®šçš„å­—ç¬¦ä¸²æ ¼å¼"å°†è¾“å…¥æ•°æ®ç»‘å®šåˆ°æ•°æ®åº“ä¸­ã€‚"Row ID" åˆ—æˆ– large binary é¡¹(e.g. blobs or `RAW` columns)ä¹Ÿå­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ã€‚è¿™ç‚¹å¯¹äº Python æ¥è¯´å¹¶ä¸å‹å¥½ï¼Œå› ä¸ºä¼ é€’ç»™ `execute*()` çš„å‚æ•°æ˜¯æ— ç±»å‹çš„ã€‚å½“æ•°æ®åº“æ¨¡å—çœ‹åˆ° Python å­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼Œå®ƒå¹¶ä¸çŸ¥é“åº”è¯¥å°†å…¶ç»‘å®šåˆ°ä½•ç§æ•°æ®åº“ç±»å‹ â€”â€” æ•°æ®åº“æ¨¡å—ä¼šå¾ˆå›°æƒ‘ï¼Œæ˜¯è¯¥ç»‘å®šåˆ° `CHAR` åˆ—ï¼Œè¿˜æ˜¯ç»‘å®šåˆ° `BINARY` é¡¹ï¼ŒæŠ‘æˆ–æ˜¯ç»‘å®šåˆ° `DATE` å–ƒï¼Ÿ

ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæ¨¡å—å¿…é¡»æä¾›ä»¥ä¸‹æ„é€ å™¨ï¼Œä»è€Œå¯ä»¥åˆ›å»ºèƒ½å¤Ÿä¿æŒç‰¹å®šå€¼çš„å¯¹è±¡ã€‚å½“æˆ‘ä»¬å°†ä¸‹è¿°å¯¹è±¡ä¼ é€’ç»™ cursor çš„æ–¹æ³•æ—¶ï¼Œæ¨¡å—å°±èƒ½å¤Ÿæ£€æŸ¥åˆ°è¾“å…¥å‚æ•°çš„æ­£ç¡®ç±»å‹ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°æ•°æ®åº“ä¸­ã€‚

æ¨¡å—å°†åŒ…å«ä»¥ä¸‹çš„æ„é€ å‡½æ•°ï¼š

- **Date(year, month, day)**

  æ­¤å‡½æ•°ä¼šæ„é€ ä¸€ä¸ªä¿å­˜ data å€¼çš„å¯¹è±¡ã€‚

- **Time(*hour*, *minute*, *second*)**

  æ­¤å‡½æ•°ä¼šæ„é€ ä¸€ä¸ªä¿å­˜ time å€¼çš„å¯¹è±¡ã€‚

- **Timestamp(year, month, day, hour, minute, second)**

  æ­¤å‡½æ•°ä¼šæ„é€ ä¸€ä¸ªä¿å­˜ time stamp å€¼çš„å¯¹è±¡ã€‚

- **DateFromTicks(*ticks*)**

  æ­¤å‡½æ•°ä¼šæ ¹æ®ç»™å®šçš„ *ticks* å€¼æ¥æ„é€ ä¸€ä¸ªä¿å­˜ data å€¼çš„å¯¹è±¡ã€‚*ticks* æ˜¯è‡ªçºªå…ƒ(*epoch*)ä»¥æ¥ç§’æ•°ï¼Œè¯¦è§ [the standard Python time module](http://docs.python.org/library/time.html) 

- **TimeFromTicks(*ticks*)**

  æ­¤å‡½æ•°ä¼šæ ¹æ®ç»™å®šçš„ *ticks* å€¼æ¥æ„é€ ä¸€ä¸ªä¿å­˜ time å€¼çš„å¯¹è±¡ã€‚*ticks* æ˜¯è‡ªçºªå…ƒ(*epoch*)ä»¥æ¥ç§’æ•°ï¼Œè¯¦è§ [the standard Python time module](http://docs.python.org/library/time.html) 

- **TimestampFromTicks(*ticks*)**

  æ­¤å‡½æ•°ä¼šæ ¹æ®ç»™å®šçš„ *ticks* å€¼æ¥æ„é€ ä¸€ä¸ªä¿å­˜ time stamp å€¼çš„å¯¹è±¡ã€‚*ticks* æ˜¯è‡ªçºªå…ƒ(*epoch*)ä»¥æ¥ç§’æ•°ï¼Œè¯¦è§ [the standard Python time module](http://docs.python.org/library/time.html) 

- **Binary(*string*)**

  æ­¤å‡½æ•°ä¼šæ„é€ ä¸€ä¸ªèƒ½å¤Ÿä¿å­˜ binary (long) å­—ç¬¦ä¸²å€¼çš„å¯¹è±¡ã€‚

  ```python
  # Binary's source code in pymysql
  def Binary(x):
      """Return x as a binary type."""
      if PY2:
          return bytearray(x)
      else:
          return bytes(x)
  ```

  è¯¦è§ç¬”è®°: ï¹bytes.mdï¹

åœ¨è¾“å…¥/è¾“å‡ºä¸­ï¼ŒSQL çš„ `NULL` å€¼ä¼šè¡¨ç¤ºä¸º Python çš„ `None` å•ä¾‹å¯¹è±¡ã€‚

> âš : åœ¨æ•°æ®åº“æ¥å£ä¸­ä½¿ç”¨ Unix ticks å¯èƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„éº»çƒ¦ï¼Œå› ä¸º Unix ticks ä»…è¦†ç›–æœ‰é™çš„æ—¥æœŸèŒƒå›´

## ç±»å‹å¯¹è±¡

Cursor å¯¹è±¡çš„ `.descripton` å­—æ®µä¼šè¿”å›"æŸ¥è¯¢ç»“æœ"ä¸­æ¯ä¸€åˆ—çš„ç›¸å…³ä¿¡æ¯ï¼Œå…¶ä¸­çš„ `type_code` å¿…é¡»ç­‰äºä¸‹è¿°æŸä¸ª Type Objectï¼ŒåŒä¸€ä¸ª Type Object å¯èƒ½ä¼šä¸å¤šä¸ªç±»å‹ä»£ç (*type* *code*)ç›¸ç­‰ (e.g. `DATETIME` could be equal to the type codes for date, time and timestamp columns; see the [Implementation Hints](https://www.python.org/dev/peps/pep-0249/#implementation-hints) below for details).

æ¨¡å—å°†åŒ…å«ä»¥ä¸‹å•ä¾‹(*singleton*)å½¢å¼çš„ Type Objectï¼š

- **STRING type**

  æ­¤ Type Object ç”¨äºæè¿°æ•°æ®åº“ä¸­çš„ string-based åˆ—ï¼Œå¦‚ `CHAR` 

- **BINARY type**

  æ­¤ Type Object ç”¨äºæè¿°æ•°æ®åº“ä¸­çš„ (long) binary åˆ—ï¼Œå¦‚ `LONG`, `RAW`, `BLOB`

- **NUMBER type**

  æ­¤ Type Object ç”¨äºæè¿°æ•°æ®åº“ä¸­çš„ numeric åˆ—

- **DATETIME type**

  æ­¤ Type Object ç”¨äºæè¿°æ•°æ®åº“ä¸­çš„ date/time åˆ—

- **ROWID type**

  æ­¤ Type Object ç”¨äºæè¿°æ•°æ®åº“ä¸­çš„ "Row ID" åˆ—

  æ‰©å±•é˜…è¯»: [Equivalent of Oracleâ€™s RowID in MySQL](https://stackoverflow.com/questions/2728413/equivalent-of-oracle-s-rowid-in-mysql)

## ç»™æ¨¡å—å®ç°è€…çš„å»ºè®®

> è¯‘è€…æ³¨: è¿™éƒ¨åˆ†å†…å®¹æ˜¯ç»™æ¨¡å—çš„å®ç°è€…çš„ä¸€äº›å»ºè®®ã€‚å¦‚æœä½ æ˜¯æ¨¡å—çš„ä½¿ç”¨è€…ï¼Œæ— éœ€è¿‡åˆ†å…³å¿ƒè¿™éƒ¨åˆ†å†…å®¹ï¼Œéšæ„æµè§ˆä¸€ä¸‹å°±å¥½ï¼ŒåŸæ–‡å†…å®¹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå› æ­¤æˆ‘æ²¡æœ‰è¿›è¡Œç¿»è¯‘ã€‚å¦‚æœä½ æƒ³äº†è§£æ¨¡å—çš„å…·ä½“å®ç°è¿‡ç¨‹ï¼Œé‚£ä¹ˆå»ºè®®ä½ ä»”ç»†çœ‹ä¸€çœ‹ã€‚

- Date/time objects can be implemented as [Python datetime module](http://docs.python.org/library/datetime.html) objects (available since Python 2.3, with a C API since 2.4) or using the [mxDateTime](http://www.egenix.com/products/python/mxBase/mxDateTime/) package (available for all Python versions since 1.5.2). They both provide all necessary constructors and methods at Python and C level.

- Here is a sample implementation of the Unix ticks based constructors for date/time delegating work to the generic constructors:

  ```
  import time
  
  def DateFromTicks(ticks):
      return Date(*time.localtime(ticks)[:3])
  
  def TimeFromTicks(ticks):
      return Time(*time.localtime(ticks)[3:6])
  
  def TimestampFromTicks(ticks):
      return Timestamp(*time.localtime(ticks)[:6])
  ```

- The preferred object type for Binary objects are the buffer types available in standard Python starting with version 1.5.2. Please see the Python documentation for details. For information about the C interface have a look at `Include/bufferobject.h` and `Objects/bufferobject.c` in the Python source distribution.

- This Python class allows implementing the above type objects even though the description type code field yields multiple values for on type object:

  ```
  class DBAPITypeObject:
      def __init__(self,*values):
          self.values = values
      def __cmp__(self,other):
          if other in self.values:
              return 0
          if other < self.values:
              return 1
          else:
              return -1
  ```

  The resulting type object compares equal to all values passed to the constructor.

- Here is a snippet of Python code that implements the exception hierarchy defined above:

  ```
  import exceptions
  
  class Error(exceptions.StandardError):
      pass
  
  class Warning(exceptions.StandardError):
      pass
  
  class InterfaceError(Error):
      pass
  
  class DatabaseError(Error):
      pass
  
  class InternalError(DatabaseError):
      pass
  
  class OperationalError(DatabaseError):
      pass
  
  class ProgrammingError(DatabaseError):
      pass
  
  class IntegrityError(DatabaseError):
      pass
  
  class DataError(DatabaseError):
      pass
  
  class NotSupportedError(DatabaseError):
      pass
  ```

  In C you can use the `PyErr_NewException(fullname, base, NULL)` API to create the exception objects.

## å¯é€‰DB APIæ‰©å±•

åœ¨ DB API 2.0 çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæ¨¡å—ç¼–å†™è€…ç»å¸¸ä¼šç¼–å†™è¶…å‡º DB API 2.0 è§„èŒƒçš„å®ç°ã€‚ä¸ºäº†å¢å¼ºå…¼å®¹æ€§å¹¶(ä¸ºæœ¬è§„èŒƒçš„æœªæ¥ç‰ˆæœ¬)æä¾›å¹²å‡€çš„å‡çº§è·¯å¾„ï¼Œæœ¬èŠ‚ä¸ºæ ¸å¿ƒ DB API 2.0 è§„èŒƒå®šä¹‰äº†ä¸€ç»„é€šç”¨æ‰©å±•ã€‚

ä¸æ‰€æœ‰ DB API å¯é€‰åŠŸèƒ½ä¸€æ ·ï¼Œæ•°æ®åº“æ¨¡å—çš„ç¼–å†™è€…å¯ä»¥è‡ªç”±å†³å®šæ˜¯å¦éœ€è¦å®ç°è¿™äº›é¢å¤–çš„å­—æ®µå’Œæ–¹æ³•ã€‚å¦‚æœè°ƒç”¨äº†æœªå®ç°çš„å±æ€§ï¼Œåˆ™ä¼šæŠ›å‡º `AttributeError`ï¼›å¯¹äºåªèƒ½åœ¨è¿è¡Œæ—¶æ‰èƒ½æ£€æŸ¥å¯ç”¨æ€§çš„å±æ€§ï¼Œåˆ™ä¼šæŠ›å‡º [NotSupportedError](https://www.python.org/dev/peps/pep-0249/#notsupportederror) ã€‚

ä¸ºäº†è®©æ¨¡å—ä½¿ç”¨è€…å“ªäº›æ‰©å±• API å¯ç”¨ï¼Œå»ºè®®æ¨¡å—ç¼–å†™è€…é€šè¿‡ Python warning æ¡†æ¶å‘ç¨‹åºå‘˜å‘å‡º Python warningã€‚ä¸ºäº†ä½¿ warning åŠŸèƒ½å¯ç”¨ï¼Œå¿…é¡»å¯¹è­¦å‘Šæ¶ˆæ¯è¿›è¡Œæ ‡å‡†åŒ–ï¼Œä»¥ä¾¿èƒ½å¤Ÿå±è”½å®ƒä»¬ã€‚â€œæ ‡å‡†çš„æ¶ˆæ¯â€æ˜¯æŒ‡ä¸‹è¿°å†…å®¹ä¸­æåˆ°çš„ *Warning Message* ã€‚

- ğŸ§©**Cursor.rownumber** 

  åªè¯»å±æ€§ï¼Œè¡¨ç¤º cursor åœ¨å½“å‰ç»“æœé›†ä¸­çš„ç´¢å¼•ä½ç½®(èµ·ç‚¹æ˜¯ 0)ã€‚å¦‚æœæ— æ³•ç¡®å®šç´¢å¼•ä½ç½®ï¼Œåˆ™ä¼šè¿”å› `None`ã€‚

  ç´¢å¼•ä½ç½®æ˜¯æŒ‡ cursor åœ¨åºåˆ—(ç»“æœé›†)ä¸­çš„ä½ç½®ã€‚ä¸‹ä¸€æ¬¡ fetch æ“ä½œå°†è·å–åºåˆ—(ç»“æœé›†)ä¸­ç¬¬ ` .rownumber` è¡Œã€‚

  *Warning Message:* "DB-API extension cursor.connection used"

- ğŸ§©**Connection.Error, Connection.ProgrammingError, etc.**

  æ‰€æœ‰æŒ‰ç…§ DB API æ ‡å‡†å®šä¹‰çš„å¼‚å¸¸ç±»éƒ½åº”ä½œä¸º `Connection` å¯¹è±¡çš„å±æ€§å¯¹å¤–å…¬å¼€(åœ¨æ¨¡å—ä½œç”¨åŸŸå¯ç”¨çš„é™¤å¤–)ã€‚

  è¿™äº›å±æ€§å¯ç®€åŒ–å¤šè¿æ¥(*multi*-*connection*)ç¯å¢ƒä¸­çš„é”™è¯¯é™¤äº†ã€‚

  *Warning Message:* "DB-API extension connection.\<exception\> used"

- ğŸ§©**Cursor.connection**

  åªè¯»å±æ€§ï¼Œè¿”å›åˆ›å»º Cursor å¯¹è±¡çš„ Connection å¯¹è±¡çš„å¼•ç”¨ã€‚

  è¯¥å±æ€§å¯ç®€åŒ–åœ¨å¤šè¿æ¥(*multi*-*connection*)ç¯å¢ƒä¸­ç¼–å†™å¤šæ€(*polymorph*)ä»£ç çš„è¿‡ç¨‹ã€‚

  *Warning Message:* "DB-API extension cursor.connection used"

- ğŸ§©**Cursor.scroll(*value* [, *mode='relative'* ])**

  æ”¹å˜ cursor åœ¨ç»“æœé›†ä¸­çš„ç´¢å¼•ä½ç½®ã€‚

  å¦‚æœ `mode='relative'` (é»˜è®¤æƒ…å†µ)ï¼Œåˆ™å°† *value* è§†ä½œç»“æœé›†ä¸­å½“å‰ä½ç½®çš„åç§»é‡ï¼›å¦‚æœ `mode='absolute'`ï¼Œåˆ™å°† *value* è§†ä½œç»“æœé›†ä¸­çš„ç»å¯¹ç›®æ ‡ä½ç½®ã€‚

  > Note
  >
  > This method should use native scrollable cursors, if available, or revert to an emulation for forward-only scrollable cursors. The method may raise [NotSupportedError](https://www.python.org/dev/peps/pep-0249/#notsupportederror) to signal that a specific operation is not supported by the database (e.g. backward scrolling).

  *Warning Message:* "DB-API extension cursor.scroll() used"

- ğŸ§©**Cursor.messages**

  è¯¥å­—æ®µå€¼æ˜¯ä¸€ä¸ª `list` å¯¹è±¡ï¼Œ

  è¿™æ˜¯ä¸€ä¸ª Python çš„ `list` å¯¹è±¡ï¼Œè´Ÿè´£å°†å…ƒç»„ï¼ˆå¼‚å¸¸ç±»ï¼Œå¼‚å¸¸å€¼ï¼‰é™„åŠ åˆ°ç”±æ¸¸æ ‡ä»åº•å±‚æ•°æ®åº“æ¥æ”¶çš„æ‰€æœ‰æ¶ˆæ¯ä¸Šã€‚

  é™¤äº† `.fetch*()` æ–¹æ³•ä¹‹å¤–ï¼Œè¿™ä¸ª `list` çš„å†…å®¹ä¼šè‡ªåŠ¨è¢«æ‰€æœ‰æ ‡å‡†çš„ cursor å¯¹è±¡æ–¹æ³•è°ƒç”¨æ‰€æ¸…é™¤ï¼ˆåœ¨æ–¹æ³•è¢«è°ƒç”¨å‰ï¼‰ï¼Œç›®çš„æ˜¯ä¸ºäº†é¿å…è¿‡å¤šçš„å†…å­˜æ¶ˆè€—ã€‚åŒæ ·ä½ ä¹Ÿå¯ä»¥è°ƒç”¨ `del cursor.messages[:]` çš„æ–¹å¼æ‰‹åŠ¨æ¸…é™¤ã€‚

  æ•°æ®åº“ç”Ÿæˆçš„æ‰€æœ‰é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯éƒ½æ”¾åœ¨æ­¤åˆ—è¡¨ä¸­ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥é€šè¿‡æ£€æŸ¥è¿™ä¸ª `list` çš„å†…å®¹æ¥éªŒè¯è°ƒç”¨æ–¹æ³•çš„æ“ä½œæ˜¯å¦æ­£ç¡®ã€‚

  è¿™ä¸ªå±æ€§çš„ç›®çš„æ˜¯ä¸ºäº†é¿å…é‚£äº›ä¼šå¯¼è‡´é—®é¢˜çš„å¼‚å¸¸å‘Šè­¦ï¼ˆä¸€äº›å‘Šè­¦ç¡®å®åªå«æœ‰ä¿¡æ¯ï¼‰ã€‚

  *Warning Message:* "DB-API extension cursor.messages used"

- ğŸ§©**Connection.messages**

  

- ğŸ§©**Cursor.next()**

  

- ğŸ§©**Cursor.`__iter__()`** 

  

- ğŸ§©**Cursor.lastrowid**

  



## æœ¯è¯­

### ç»“æœé›†

ç»“æœé›†(*result* *set*) - é€šè¿‡ SQL æŸ¥è¯¢è·å–åˆ°çš„æ•°æ®é›†ã€‚































