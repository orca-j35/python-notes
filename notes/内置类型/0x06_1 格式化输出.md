# å­—ç¬¦ä¸²æ ¼å¼åŒ–

[TOC]

## 1. printf-style

> æœ¬èŠ‚æ¶µç›–äº† [printf-style String Formatting](https://docs.python.org/3/library/stdtypes.html#old-string-formatting)Â ä¸­çš„å†…å®¹ï¼Œå¹¶è¿›è¡Œäº†æ‰©å±•
>
> å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç”¨äºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–°å¼è¯­æ³•å’Œæ—§å¼è¯­æ³•æ‹¥æœ‰ç›¸ä¼¼çš„è§„åˆ™ï¼Œåœ¨ä½¿ç”¨æ—¶å¯ç›¸äº’å‚è€ƒã€‚åœ¨æ–°å¼è¯­æ³•ä¸­ä½¿ç”¨ `{}` å’Œ `%` æ›¿æ¢äº†æ—§å¼è¯­æ³•ä¸­çš„ `%`ã€‚æ¯”å¦‚æ—§å¼è¯­æ³•ä¸­çš„ `'%03.2f'` å¯è¢«ç¿»è¯‘ä¸º `'{:03.2f}'`ã€‚å¦å¤–ï¼Œæ–°å¼è¯­æ³•è¿˜æ”¯æŒä¸€äº›æ–°é€‰é¡¹ã€‚

**Note:** printf-style çš„æ ¼å¼åŒ–æ“ä½œå­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œä¼šå¯¼è‡´è®¸å¤šå¸¸è§çš„é”™è¯¯ï¼ˆä¾‹å¦‚æ— æ³•æ­£ç¡®æ˜¾ç¤ºå…ƒç»„å’Œå­—å…¸ï¼‰ã€‚ä½¿ç”¨ä»¥ä¸‹ä¸‰ç§çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹å¼ï¼Œå¯é¿å…è¿™äº›é”™è¯¯ã€‚

-  [formatted string literal](https://docs.python.org/3/reference/lexical_analysis.html#f-strings)ï¼Œä¹Ÿç§°*f-string*
- [`str.format()`](https://docs.python.org/3/library/stdtypes.html#str.format) æ¥å£
- [template strings](https://docs.python.org/3/library/string.html#template-strings)  

å­—ç¬¦ä¸²å¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„å†…ç½®è¿ç®—ç¬¦ï¼š`%`  (modulo) ï¼Œä¹Ÿç§°æ ¼å¼åŒ–(*formatting*)è¿ç®—ç¬¦æˆ–æ’å€¼(*interpolation*)è¿ç®—ç¬¦ã€‚è¯¥è¿ç®—ç¬¦çš„ä½¿ç”¨æ•ˆæœç±»ä¼¼äº C è¯­è¨€ä¸­ `sprintf()` å‡½æ•°ã€‚

printf-style æœ‰å¦‚ä¸‹ä¸¤ç§å½¢å¼ï¼š

- `<format string> % <datum>` - `<format string>` ä¸­åªåŒ…å«ä¸€ä¸ªæ ¼å¼åŒ–åºåˆ—(*format sequence*)ï¼Œ`<datum>` å¿…é¡»æ˜¯å•ä¸ªå¯¹è±¡ï¼Œä¸”è¯¥å¯¹è±¡ä¸å¯ä»¥æ˜¯å¤šå…ƒç´ å…ƒç»„ã€‚

    ```python
    >>> "%s" % [1, 2, 3] # %sæ˜¯ä¸€ä¸ªæ ¼å¼åŒ–åºåˆ—
    '[1, 2, 3]'
    >>> "%s" % dict(a=1, b=2, c=3)
    "{'a': 1, 'b': 2, 'c': 3}"
    >>> "%s" % (1,) # å¯ä»¥æ˜¯å•å…ƒç´ çš„å…ƒç»„
    '1'
    >>> "%s" % (1, 2, 3) # ä¸å¯ä»¥æ˜¯å¤šå…ƒç´ å…ƒç»„
    TypeError: not all arguments converted during string formatting
    ```
    å¦‚æœéœ€è¦æ ¼å¼åŒ–è¾“å‡ºçš„å¯¹è±¡æ˜¯ä¸€ä¸ªå¤šå…ƒç´ å…ƒç»„ï¼Œåˆ™éœ€è¦å°†è¯¥å…ƒç»„åµŒå¥—åœ¨ä¸€ä¸ªå•å…ƒç´ å…ƒç»„ä¸­ï¼š

    ```python
    >>> "%s" % ((1,2,3),)
    '(1, 2, 3)'
    ```

- `<format string> % <datums>` - `<format string>` ä¸­åŒ…å« n ä¸ªæ ¼å¼åŒ–åºåˆ—ï¼Œ `<datums>` å¿…é¡»æ˜¯åŒ…å« n ä¸ªåŸºå‡†å€¼(*datum*)çš„å…ƒç»„ï¼Œæˆ–æœ‰ n ä¸ªé”®å€¼å¯¹çš„æ˜ å°„å¯¹è±¡(å¦‚å­—å…¸)ã€‚

    ```python
    >>> "%s %s %s" % ("a", "b", "c")
    'a b c'
    >>> "%(a)s %(b)s %(c)s" % dict(a=1, b=2, c=3)
    '1 2 3'
    >>> '%(language)s has %(number)03d quote types.'%{'language': "Python", "number": 2}
    'Python has 002 quote types.'
    
    >>># ä¸èƒ½ç›´æ¥ç»™å‡ºå‚æ•°ï¼Œå¿…é¡»æ‰“åŒ…åˆ°æ•°ç»„ä¸­
    >>> "%s %s %s" % "a", "b", "c"
    TypeError: not enough arguments for format string
    ```


### 1.1 è½¬æ¢è¯´æ˜ç¬¦

`<format string> ` ä¸­çš„**æ ¼å¼åŒ–åºåˆ—**ä¹Ÿè¢«ç§°ä¸º**è½¬æ¢è¯´æ˜ç¬¦**(*conversion specifier*)ã€‚
è½¬æ¢è¯´æ˜ç¬¦è‡³å°‘éœ€è¦åŒ…å«ä¸¤ä¸ªå­—ç¬¦( å¦‚,  `%s` )ã€‚
è½¬æ¢è¯´æ˜ç¬¦ä¸­å„ä¸ªç»„ä»¶(*components*)çš„é¡ºåºå¦‚ä¸‹ï¼š

```
%[Mapping_key][Conversion_flags][Minimum_field_width][.Precision][Length_modifier][Conversion_type]
```

è½¬æ¢è¯´æ˜ç¬¦ä¸­ç›¸å…³ç»„ä»¶çš„æè¿°å¦‚ä¸‹ï¼š

1. `%` æ ‡è¯†è½¬æ¢è¯´æ˜ç¬¦çš„èµ·ç‚¹

2. `mapping_key` (å¯é€‰)ï¼Œç”±å¸¦æ‹¬å·çš„å­—ç¬¦åºåˆ—ç»„æˆï¼Œå¦‚  `(somename)` ã€‚å½“ `<datums>` æ˜¯å­—å…¸(æˆ–å…¶å®ƒæ˜ å°„ç±»å‹)æ—¶ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ `mapping_key` ï¼Œå¹¶ç”¨ `mapping_key` è¡¨ç¤ºå­—å…¸ä¸­ç›¸åº”çš„ `key` (è¿™ç§æƒ…å†µä¸‹ï¼Œè½¬æ¢è¯´æ˜ç¬¦ä¸­ä¸ä¼šå‡ºç° `*` æ˜Ÿå·ï¼Œå› ä¸ºåªæœ‰ `<datums>` æ˜¯åºåˆ—ç±»å‹æ—¶æ‰èƒ½ä½¿ç”¨ `*` )ã€‚

   ```Python
   >>> aDict = dict(a=1, b=2, c=3)
   >>> "%(b)s %(a)s " % aDict # ä¸å¿…ä½¿ç”¨æ‰€æœ‰keyï¼Œé¡ºåºä¹Ÿå¯ä»¥å˜åŒ–
   '2 1 '
   >>> '%(language)s has %(number)03d quote types.'%{'language': "Python", "number": 2}
   'Python has 002 quote types.'
   ```

3. `Conversion_flags` (å¯é€‰)ï¼Œä¼šå½±å“æŸäº›è£…æ¢ç±»å‹(*conversion types*)çš„ç»“æœã€‚

4. `Minimum_field_width` (å¯é€‰)ã€‚å¦‚æœå°† `Minimum_field_width` è®¾ç½®ä¸º `'*'` æ˜Ÿå·(*asterisk*)ï¼Œé‚£ä¹ˆéœ€è¦å°†å®é™…çš„`width`å€¼æ”¾ç½®åœ¨ç›¸åº”çš„åŸºå‡†å€¼ä¹‹å‰ã€‚å¦‚æœ `.Precision` ä¹Ÿä½¿ç”¨äº† `*` ï¼Œé‚£ä¹ˆåŸºå‡†å€¼åº”ä½äº `width` å€¼å’Œ  `.precision` å€¼ä¹‹åã€‚

   ```Python
   >>> "%*s,%*s,%s" % (4, "a", 4, "b", "c") # 4æ˜¯widthï¼Œ'a'æ˜¯åŸºå‡†å€¼
   '   a,   b,c'
   ```

5. `.Precision`  (å¯é€‰)ï¼Œç²¾åº¦å€¼è·Ÿåœ¨ `.`(*dot*) ä¹‹åã€‚å¦‚æœå°†`.Precision`  è®¾ç½®ä¸º `'*'` æ˜Ÿå·ï¼Œé‚£ä¹ˆéœ€è¦å°†å®é™…çš„ç²¾åº¦å€¼æ”¾ç½®åœ¨ç›¸åº”çš„åŸºå‡†å€¼ä¹‹å‰ã€‚

   ```python
   >>> import math
   >>> "%.*f" % (2, math.pi) # 2æ˜¯ç²¾åº¦ï¼Œ'a'æ˜¯åŸºå‡†å€¼
   '3.14'
   ```

   å¯¹äºéæ•°å€¼ç±»å‹ï¼Œ`precision` è¡¨ç¤ºæœ€å¤§é•¿åº¦

   ```python
   >>> "%.2s"%'sdsssss'
   'sd'
   ```

6. `Length_modifier` (å¯é€‰)ï¼Œè™½ç„¶å¯ä»¥æ·»åŠ  length ä¿®é¥°ç¬¦ (`h`, `l`, æˆ– `L`) ï¼Œä½†è¯¥ä¿®é¥°ç¬¦ä¼šè¢« Python å¿½ç•¥ã€‚åŸå› æ˜¯ Python å¹¶ä¸éœ€è¦è¯¥ä¿®é¥°ç¬¦ï¼Œæ‰€ä»¥åœ¨ Python ä¸­ `%ld` ä¸ `%d` å®Œå…¨ç­‰ä»·ã€‚

7. `Conversion_type` 

### 1.2 Conversion_flags

```
%[Mapping_key][Conversion_flags][Minimum_field_width][.Precision][Length_modifier][Conversion_type]
```

`Conversion_flags` å­—ç¬¦å«ä¹‰å¦‚ä¸‹ï¼š

| Flag  | Meaning                                                      |
| ----- | ------------------------------------------------------------ |
| `'#'` | ä½¿ç”¨"æ›¿ä»£å½¢å¼(*alternate form*) "è¡¨ç¤ºè½¬æ¢åçš„å†…å®¹ï¼Œåœ¨**Notes**å°èŠ‚ä¸­ä¼šè¯¦ç»†é˜è¿° |
| `'0'` | åœ¨æ•°å€¼å·¦ä¾§ä½¿ç”¨ 0 è¿›è¡Œå¡«å……ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ç©ºæ ¼ã€‚                |
| `'-'` | å°†è½¬æ¢åçš„å†…å®¹åœ¨ç»™å®šçš„å­—æ®µå®½åº¦å†…å·¦å¯¹é½ï¼Œé»˜è®¤æ˜¯å³å¯¹é½(å¦‚æœ `'-'` å’Œ `'0'` åŒæ—¶å­˜åœ¨ï¼Œ`'-'` ä¼šè¦†ç›– `'0'` )ã€‚å¦‚æœè½¬æ¢åçš„å†…å®¹å¤§äºç»™å®šçš„å­—æ®µå®½åº¦ï¼Œåˆ™ä¸è¿›è¡Œå¯¹é½ã€‚ |
| `' '` | åœ¨æ­£æ•°å‰æ’å…¥ä¸€ä¸ªç©ºæ ¼                                         |
| `'+'` | åœ¨æ­£æ•°å‰æ’å…¥  `'+'`  (ä¼šè¦†ç›– `' '` æ ‡è®°)ï¼Œè´Ÿæ•°ä¼šé»˜è®¤æ˜¾ç¤ºè´Ÿå· |

```python
>>> import math
# '0' æ¼”ç¤º
>>> "%06.2f" % math.pi
'003.14'
# â€˜-â€™ æ¼”ç¤º
>>> "%-6s" % "Hi!"
'Hi!   '
>>> "%-06.2f" % math.pi
'3.14  '
```

### 1.3 Conversion_type

```
%[Mapping_key][Conversion_flags][Minimum_field_width][.Precision][Length_modifier][Conversion_type]
```

`Conversion_type` å­—ç¬¦å«ä¹‰å¦‚ä¸‹

| Conversion | Meaning                                                      | Notes |
| ---------- | ------------------------------------------------------------ | ----- |
| `'d'`      | æœ‰ç¬¦å·åè¿›åˆ¶æ•´æ•°                                             |       |
| `'i'`      | æœ‰ç¬¦å·åè¿›åˆ¶æ•´æ•°                                             |       |
| `'o'`      | æœ‰ç¬¦å·å…«è¿›åˆ¶æ•´æ•°                                             | (1)   |
| `'u'`      | åºŸå¼ƒçš„ç±»å‹ï¼Œå«ä¹‰ä¸ `'d'` ç›¸åŒ                                | (6)   |
| `'x'`      | æœ‰ç¬¦å·åå…­è¿›åˆ¶æ•°(å°å†™)                                       | (2)   |
| `'X'`      | æœ‰ç¬¦å·åå…­è¿›åˆ¶æ•°(å¤§å†™)                                       | (2)   |
| `'e'`      | æŒ‡æ•°æ ¼å¼çš„æµ®ç‚¹æ•°(å°å†™)                                       | (3)   |
| `'E'`      | æŒ‡æ•°æ ¼å¼çš„æµ®ç‚¹æ•°(å¤§å†™)                                       | (3)   |
| `'f'`      | å°æ•°æ ¼å¼çš„æµ®ç‚¹æ•°                                             | (3)   |
| `'F'`      | å°æ•°æ ¼å¼çš„æµ®ç‚¹æ•°                                             | (3)   |
| `'g'`      | æµ®ç‚¹æ ¼å¼ã€‚å¦‚æœæŒ‡æ•°å°äº -4 æˆ–å¤§äºç­‰äºç²¾åº¦æ—¶ï¼Œä¼šé‡‡ç”¨ `'e'` æ ¼å¼ï¼›å¦åˆ™é‡‡ç”¨å°æ•°æ ¼å¼çš„æµ®ç‚¹æ•°ã€‚ | (4)   |
| `'G'`      | æµ®ç‚¹æ ¼å¼ã€‚å¦‚æœæŒ‡æ•°å°äº -4 æˆ–å¤§äºç­‰äºç²¾åº¦æ—¶ï¼Œä¼šé‡‡ç”¨ `'E'` æ ¼å¼ï¼›å¦åˆ™é‡‡ç”¨å°æ•°æ ¼å¼çš„æµ®ç‚¹æ•°ã€‚ | (4)   |
| `'c'`      | å•ä¸ªå­—ç¬¦(æ¥å—æ•´æ•°ï¼Œæˆ–ä»…åŒ…å«å•ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²)                 |       |
| `'r'`      | String (ä½¿ç”¨ [`repr()`](https://docs.python.org/3/library/functions.html#repr) å‡½æ•°è½¬æ¢ç›¸åº”çš„ Python å¯¹è±¡). | (5)   |
| `'s'`      | String (ä½¿ç”¨ [`str()`](https://docs.python.org/3/library/stdtypes.html#str) å‡½æ•°è½¬æ¢ç›¸åº”çš„Python å¯¹è±¡). | (5)   |
| `'a'`      | String (ä½¿ç”¨ [`ascii()`](https://docs.python.org/3/library/functions.html#ascii)å‡½æ•°è½¬æ¢ç›¸åº”çš„Python å¯¹è±¡). | (5)   |
| `'%'`      | ä¸è¿›è¡Œè½¬æ¢ï¼Œä¼šç›´æ¥å¾—åˆ° `'%'` ã€‚                              |       |

å…³äº `'c'` çš„ç¤ºä¾‹ - å°†æŸä¸ªæ•´æ•°è£…æ¢ä¸ºç›¸åº”çš„å­—ç¬¦

```python
>>> '%c'% 10
'\n'
```

å…³äº `'g'` çš„ç¤ºä¾‹ï¼š

```python
# æ ¼å¼åŒ–çš„é»˜è®¤ç²¾åº¦æ˜¯6ä½å°æ•°ï¼Œæ‰€ä»¥å½“æ•´æ•°éƒ¨åˆ†çš„é•¿åº¦å¤§äºç­‰äº7æ—¶ï¼Œ
# ä¾¿ä¼šé‡‡ç”¨æŒ‡æ•°å½¢å¼
>>> "%g" % 1234567
'1.23457e+06'
>>> "%.2g" % 1234
'1.2e+03'
# æŒ‡æ•°å°äº-4ï¼Œä¹Ÿä¼šé‡‡ç”¨æŒ‡æ•°å½¢å¼
>>> "%g" % 0.000023456789
'2.34568e-05'
```

å…³äº `'%'` æ ‡è®°ï¼Œ å¦‚æœåœ¨å­—ç¬¦ä¸²ä¸­éœ€è¦ç”¨åˆ°ä¸€ä¸ªæ™®é€šçš„ `%` ï¼Œä¾¿å¯åœ¨`<format string> ` ä¸­ä½¿ç”¨ `'%%'` å¾—åˆ°ä¸€ä¸ª `'%'` ã€‚

```
>>> 'growth rate: %d %%' % 7
'growth rate: 7 %'
```

#### a. Notes

1. å¦‚æœä½¿ç”¨è½¬æ¢æ ‡è¯†ç¬¦ `#`ï¼Œåˆ™ä¼šåœ¨ç¬¬ä¸€ä¸ªæ•°å­—å‰æ’å…¥å…«è¿›åˆ¶æ ‡è¯†ç¬¦ (`'0o'`)  

   ```python
   >>> '%#o' % 10
   '0o12'
   ```

2. å¦‚æœä½¿ç”¨è½¬æ¢æ ‡è¯†ç¬¦ `#`ï¼Œåˆ™ä¼šåœ¨ç¬¬ä¸€ä¸ªæ•°å­—å‰æ’å…¥åå…­è¿›åˆ¶æ ‡è¯†ç¬¦ ( `'0x'` or `'0X'` ) 

   ```python
   >>> '%#x' % 10
   '0xa'
   ```

3. å¦‚æœä½¿ç”¨è½¬æ¢æ ‡è¯†ç¬¦ `#`ï¼Œåˆ™ä¼šå¯¼è‡´ç»“æœå§‹ç»ˆåŒ…å«å°æ•°ç‚¹ï¼Œå³ä½¿å°æ•°ç‚¹åæ²¡æœ‰æ•°å­—ã€‚
   ç²¾åº¦(*precision*)ç”¨äºç¡®å®šå°æ•°ç‚¹åçš„æœ‰æ•ˆä½æ•°ï¼Œé»˜è®¤æ˜¯ 6 ä½å°æ•°ã€‚

   ```python
   >>> "%#.0f" % 2
   '2.'
   >>> "%.0f" % 2
   '2'
   >>> "%#f" % 2
   '2.000000'
   >>> "%f" % 2
   '2.000000'
   ```

4. å¦‚æœä½¿ç”¨è½¬æ¢æ ‡è¯†ç¬¦ `#`ï¼Œåˆ™ä¼šå¯¼è‡´ç»“æœå§‹ç»ˆåŒ…å«å°æ•°ç‚¹ï¼Œå¹¶ä¸”ä¸ä¼šåˆ é™¤å°¾éšé›¶ã€‚
   ç²¾åº¦ç”¨äºç¡®å®šå°æ•°ç‚¹åçš„æœ‰æ•ˆä½æ•°ï¼Œé»˜è®¤æ˜¯ 6 ä½å°æ•°ã€‚

   ```python
   >>> "%g" % 0.00002 # å¦‚æœç»“æœæ²¡å°æ•°éƒ¨åˆ†ï¼Œåˆ™åªä¿ç•™æ•´æ•°éƒ¨åˆ†
   '2e-05'
   >>> "%#g" % 0.00002 # ä¼šä¿ç•™å°æ•°ç‚¹å’Œå°¾éšé›¶
   '2.00000e-05'
   >>> "%#.0g" % 0.00002 # å¼ºè¡Œå‹ç¼©ç²¾åº¦ï¼Œä¹Ÿä¼šä¿ç•™å°æ•°ç‚¹
   '2.e-05'
   ```

5. å¦‚æœç²¾åº¦å€¼ä¸º `N` ï¼Œåˆ™ä¼šæˆªå–ç»“æœçš„å‰ `N` ä¸ªå­—ç¬¦ã€‚

   ```python
   >>> "%.4s" % '1234567'
   '1234'
   >>> "%.4r" % '1234567'
   "'123"
   >>> "%.4a" % '1234567'
   "'123"
   ```

6. å‚è€ƒ [**PEP 237**](https://www.python.org/dev/peps/pep-0237).

å› ä¸º Python çš„å­—ç¬¦ä¸²æœ‰æ˜ç¡®çš„é•¿åº¦ï¼Œå› æ­¤Â `%s` è½¬æ¢ä¸ä¼šå‡å®šå­—ç¬¦ä¸²ä»¥ `\0` ç»“å°¾ã€‚

**Changed in version 3.1**ï¼šå¯¹ç»å¯¹å€¼è¶…è¿‡ 1e50 çš„å€¼è¿›è¡Œ `%f` è½¬æ¢æ—¶ï¼Œä¸ä¼šå†å°† `%f` æ›¿æ¢ä¸º `%g` ã€‚

## 2. f-string

> `str.format()` å’Œ `string.Formatter()` ç±»å‡é‡‡ç”¨"æ ¼å¼åŒ–å­—ç¬¦ä¸²è¯­æ³•"(*Format String Syntax*)ï¼Œè¯¥è¯­æ³•å’Œ *f-string* çš„è¯­æ³•ç›¸ä¼¼ï¼Œä½†å­˜åœ¨ä¸€äº›åŒºåˆ«ã€‚æœ‰å…³"æ ¼å¼åŒ–å­—ç¬¦ä¸²è¯­æ³•"çš„è¯¦ç»†ä¿¡æ¯å¯é˜…è¯»ã€string â€” Common string operations.mdã€-> Format String Syntax
>
> *f-string*ã€`string .format()`ã€`string.Formatter` ä½¿ç”¨ç›¸åŒçš„"æ ¼å¼åŒ–è¯´æ˜ç¬¦"([format specifier mini-language](https://docs.python.org/3.7/library/string.html#formatspec))ï¼Œè¯¦è§ç¬”è®°ã€string â€” Common string operations.mdã€-> "Format Specification Mini-Language"ã€‚
>
> æœ‰å…³ *f-string* çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·é˜…è¯»ç¬”è®°ã€2. Lexical analysis.mdã€-> "2.4.3. æ ¼å¼åŒ–å­—ç¬¦ä¸²å­—é¢å€¼"ï¼Œè¿™é‡Œä»…æä¾›ç®€è¦æ¦‚è¿°ã€‚

å‰ç¼€ä¸­åŒ…å«  `f` æˆ– `F`  çš„å­—ç¬¦ä¸²å­—é¢å€¼å±äº *formatted string literal* (æˆ–ç§° *f-string* ) ã€‚è¿™äº›å­—ç¬¦ä¸²å¯èƒ½ä¼šåŒ…å«æ›¿æ¢å­—æ®µ(*replacement_field*)ï¼Œæ›¿æ¢å­—æ®µæ˜¯æŒ‡è¢«ç½®äºèŠ±æ‹¬å· `{}` ä¸­çš„è¡¨è¾¾å¼ã€‚è™½ç„¶å…¶å®ƒå­—ç¬¦ä¸²å­—é¢å€¼æ€»ä¼šæ‹¥æœ‰ä¸€ä¸ªå¸¸é‡å€¼ï¼Œä½†æ ¼å¼åŒ–å­—ç¬¦ä¸²å´ä¼šåœ¨è¿è¡Œæ—¶å¯¹**è¡¨è¾¾å¼æ±‚å€¼**ã€‚*f-string* çš„è¯­æ³•å¦‚ä¸‹ï¼š

```python
f_string          ::=  (literal_char | "{{" | "}}" | replacement_field)*
replacement_field ::=  "{" f_expression ["!" conversion] [":" format_spec] "}"
f_expression      ::=  (conditional_expression | "*" or_expr)
                         ("," conditional_expression | "," "*" or_expr)* [","]
                       | yield_expression
conversion        ::=  "s" | "r" | "a"
format_spec       ::=  (literal_char | NULL | replacement_field)*
literal_char      ::=  <any code point except "{", "}" or NULL>
```

*f-string* ä¸­çš„è¡¨è¾¾å¼ `f_expression` åº”è¢«è§†ä½œä½äºæ‹¬å·ä¸­çš„å¸¸è§„ Python è¡¨è¾¾å¼ã€‚

Python ä¼šä½¿ç”¨ [`format()`](https://docs.python.org/3.6/library/functions.html#format) åè®®å¯¹è¡¨è¾¾å¼çš„ç»“æœ (æˆ–æ˜¯ç»è½¬æ¢åçš„ç»“æœ) è¿›è¡Œæ ¼å¼åŒ–ã€‚æ ¼å¼åŒ–è¯´æ˜ç¬¦ (*format specifier*) ä¼šè¢«ä¼ é€’åˆ°è¡¨è¾¾å¼çš„ç»“æœçš„  [`__format__()`](https://docs.python.org/3.6/reference/datamodel.html#object.__format__) æ–¹æ³•ä¸­ï¼Œæˆ–æ˜¯è¢«ä¼ é€’åˆ°ç»è½¬æ¢åçš„ç»“æœçš„ [`__format__()`](https://docs.python.org/3.6/reference/datamodel.html#object.__format__) æ–¹æ³•ä¸­ã€‚å½“æ ¼å¼è¯´æ˜ç¬¦è¢«çœç•¥æ—¶ï¼Œä¼šä¼ é€’ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚ç„¶åå°†æ ¼å¼åŒ–ä¹‹åçš„æœ€ç»ˆç»“æœæ’å…¥åˆ°æ•´ä¸ªå­—ç¬¦ä¸²çš„æœ€ç»ˆå€¼ä¸­ã€‚

é¡¶å±‚ `replacement_field` ä¸­å¯èƒ½ä¼šåŒ…å«åµŒå¥—çš„æ›¿æ¢å­—æ®µã€‚è¿™äº›åµŒå¥—çš„å­—æ®µå¯èƒ½ä¼šåŒ…å«å®ƒä»¬è‡ªå·±çš„è½¬æ¢å­—æ®µå’Œæ ¼å¼åŒ–åºåˆ—ï¼Œä½†æ˜¯ä¸èƒ½åŒ…å«æ›´æ·±å±‚æ¬¡çš„åµŒå¥—å­—æ®µã€‚

ä¸€äº›ç®€å•ç¤ºä¾‹ï¼š

```python
>>> name = "Fred"
>>> f"He said his name is {name!r}."
"He said his name is 'Fred'."
>>> f"He said his name is {repr(name)}."  # repr() is equivalent to !r
"He said his name is 'Fred'."
>>> width = 10
>>> precision = 4
>>> value = decimal.Decimal("12.34567")
>>> f"result: {value:{width}.{precision}}"  # nested fields åµŒå¥—å­—æ®µ
'result:      12.35'
>>> today = datetime(year=2017, month=1, day=27)
>>> f"{today:%B %d, %Y}"  # using date format specifier
'January 27, 2017'
>>> number = 1024
>>> f"{number:#0x}"  # using integer format specifier
'0x400'
```

### 2.1 vs. str.format

*f-string* å’Œ `string .format()` ä½¿ç”¨ç›¸åŒçš„æ ¼å¼åŒ–è¯´æ˜ç¬¦â€”â€”[format specifier mini-language](https://docs.python.org/3.7/library/string.html#formatspec) ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼š

- *f-string* çš„ `replacement_field` å¯æ¥å—ä»»æ„è¡¨è¾¾å¼

  ```
  replacement_field ::=  "{" f_expression ["!" conversion] [":" format_spec] "}"
  ```

- `string.fomat()` åªèƒ½æ¥å—å­—æ®µå

  ```
  replacement_field ::=  "{" [field_name] ["!" conversion] [":" format_spec] "}"
  ```

## 3. str.format

> `str.format()` å’Œ `string.Formatter` ç±»å‡é‡‡ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è¯­æ³•(*Format String Syntax*)ï¼Œè¯¥è¯¥è¯­æ³•å’Œ *f-string* çš„è¯­æ³•ç›¸ä¼¼ï¼Œä½†å­˜åœ¨ä¸€äº›åŒºåˆ«ã€‚æœ‰å…³æ ¼å¼åŒ–å­—ç¬¦ä¸²è¯­æ³•çš„è¯¦ç»†ä¿¡æ¯å¯é˜…è¯»ã€string â€” Common string operations.mdã€ã€‚
>
> *f-string*ã€`string .format()`ã€`string.Formatter` ä½¿ç”¨ç›¸åŒçš„æ ¼å¼åŒ–è¯´æ˜ç¬¦([format specifier mini-language](https://docs.python.org/3.7/library/string.html#formatspec))ï¼Œè¯¦è§ç¬”è®°ã€string â€” Common string operations.mdã€-> "Format Specification Mini-Language"ã€‚
>
> æœ¬èŠ‚æ¶µç›–äº† [str.format(*args, **kwargs)](https://docs.python.org/3.7/library/stdtypes.html#str.format) ä¸­çš„å†…å®¹ã€‚

ğŸ”¨ str.format(\**args*, \*\**kwargs*)

è¯¥æ–¹æ³•ç”¨äºæ‰§è¡Œå­—ç¬¦ä¸²æ ¼å¼åŒ–æ“ä½œï¼Œå­—ç¬¦ä¸²å¯¹è±¡ä¸­éœ€åŒ…å«ï¼šæ–‡æœ¬å­—é¢å€¼å’Œæ›¿æ¢å­—æ®µã€‚æ›¿æ¢å­—æ®µæ˜¯æŒ‡è¢«ç½®äºèŠ±æ‹¬å¼§(*curly braces*) `{}` ä¸­çš„è¡¨è¾¾å¼ï¼Œå…¶ä¸­å¯åŒ…å«ä½ç½®å®å‚çš„æ•°å€¼ç´¢å¼•ï¼Œæˆ–åŒ…å«å…³é”®å­—å®å‚çš„åç§°ã€‚`str.format` æ–¹æ³•ä¼šåŸºäºå½“å‰å­—ç¬¦ä¸²åˆ›å»ºä¸€ä¸ªæ–°å‰¯æœ¬ï¼Œå¹¶ç”¨å®å‚æ›¿æ¢æ‰å‰¯æœ¬ä¸­å¯¹åº”çš„å­—æ®µã€‚

```python
>>> "The sum of 1 + 2 is {0}".format(1+2)
'The sum of 1 + 2 is 3'
```

æœ‰å…³æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„è¯¦ç»†è¯­æ³•ï¼Œè¯·é˜…è¯»  [Format String Syntax](https://docs.python.org/3/library/string.html#formatstrings)ï¼›`str.format` ä¸ `string.Formatter` æ‹¥æœ‰ç›¸åŒçš„å®ç°æ–¹å¼ï¼Œå¦‚æœæƒ³äº†è§£ `str.format` çš„å®ç°æ–¹å¼ ï¼Œå¯ä»¥å‚è€ƒã€string â€” Common string operations.mdã€-> "Custom String Formatting"ã€‚

> Note - When formatting a number ([`int`](https://docs.python.org/3.7/library/functions.html#int), [`float`](https://docs.python.org/3.7/library/functions.html#float), [`complex`](https://docs.python.org/3.7/library/functions.html#complex), [`decimal.Decimal`](https://docs.python.org/3.7/library/decimal.html#decimal.Decimal) and subclasses) with the `n` type (ex: `'{:n}'.format(1234)`), the function temporarily sets the `LC_CTYPE` locale to the `LC_NUMERIC` locale to decode `decimal_point` and`thousands_sep` fields of `localeconv()` if they are non-ASCII or longer than 1 byte, and the `LC_NUMERIC` locale is different than the `LC_CTYPE` locale. This temporary change affects other threads.

Changed in version 3.7: When formatting a number with the `n` type, the function sets temporarily the `LC_CTYPE` locale to the `LC_NUMERIC` locale in some cases.

## 4. string.Formatter

> `str.format()` å’Œ `string.Formatter` ç±»å‡é‡‡ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è¯­æ³•(*Format String Syntax*)ï¼Œè¯¥è¯¥è¯­æ³•å’Œ *f-string* çš„è¯­æ³•ç›¸ä¼¼ï¼Œä½†å­˜åœ¨ä¸€äº›åŒºåˆ«ã€‚æœ‰å…³æ ¼å¼åŒ–å­—ç¬¦ä¸²è¯­æ³•çš„è¯¦ç»†ä¿¡æ¯å¯é˜…è¯»ã€string â€” Common string operations.mdã€ã€‚
>
> *f-string*ã€`string .format()`ã€`string.Formatter` ä½¿ç”¨ç›¸åŒçš„æ ¼å¼åŒ–è¯´æ˜ç¬¦([format specifier mini-language](https://docs.python.org/3.7/library/string.html#formatspec))ï¼Œè¯¦è§ç¬”è®°ã€string â€” Common string operations.mdã€-> "Format Specification Mini-Language"ã€‚
>
> æœ‰å…³ `string .format()` çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·é˜…è¯»ç¬”è®°ã€string â€” Common string operations.mdã€-> "Custom String Formatting"ï¼Œè¿™é‡Œä»…æä¾›ç®€è¦æ¦‚è¿°ã€‚

ğŸ”¨ Formatter.format(*format_string*, \**args*, \*\**kwargs*) 

- format(*format_string*, \**args*, \*\**kwargs*)

  ```python
  >>> from string import Formatter
  >>> f = Formatter()
  >>> f.format('format_stringï¼š{0}_{1}', 'Orca', 'J35')
  'format_stringï¼šOrca_J35'
  >>> f.format('format_stringï¼š{0}_{1}', *('Orca', 'J35'))
  'format_stringï¼šOrca_J35'
  ```

- vformat(*format_string*, *args*, *kwargs*) - å°†è¯¥æ–¹æ³•ä½œä¸ºä¸€ä¸ªç‹¬ç«‹æ–¹æ³•çš„åŸå› æ˜¯ï¼šå½“å®å‚å·²è¢«æ‰“åŒ…åˆ°æŸç§æ•°æ®ç»“æ„ä¸­æ—¶ï¼Œå¯è·³è¿‡å¯¹å®å‚è¿›è¡Œè§£åŒ…çš„æ­¥éª¤ â€”â€” å…å»éœ€è¦å…ˆæ‹†å°å‚æ•°åˆ° `format` æ–¹æ³•ï¼Œç„¶åé€šè¿‡ `format` æ–¹æ³•å†æ¬¡æ‰“åŒ…å‚æ•°ï¼Œç„¶åå†è°ƒç”¨ `vformat` æ–¹æ³•çš„é‡å¤æ“ä½œã€‚`vformat` ä¼šå°† `format_string` æ‹†åˆ†ä¸ºå­—ç¬¦æ•°æ®å’Œæ›¿æ¢å­—æ®µã€‚

  ```python
  >>> f.vformat('format_stringï¼š{0}_{1}', ('Orca', 'J35'),{})
  'format_stringï¼šOrca_J35'
  ```

  `vformat` ä¼šè°ƒç”¨ä»¥ä¸‹æ–¹æ³•æ¥å®Œæˆæ ¼å¼åŒ–æ“ä½œï¼š(ä¸‹é¢è¿™äº›æ–¹æ³•å‡å¯è¢«å­ç±»è¦†å†™ï¼Œä»è€Œè¾¾åˆ°è‡ªå®šä¹‰æ ¼å¼æ“ä½œçš„ç›®çš„)

  - parse(*format_string*) 
  - get_field(*field_name*, *args*, *kwargs*) 
  - get_value(*key*, *args*, *kwargs*)
  - check_unused_args(*used_args*, *args*, *kwargs*) 
  - format_field(*value*, *format_spec*)
  - convert_field(*value*, *conversion*) 

## 5. string.Template

> æœ‰å…³ `string.Template()` çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·é˜…è¯»ç¬”è®°ã€string â€” Common string operations.mdã€-> Template strings

æ¨¡æ¿å­—ç¬¦ä¸²åªè´Ÿè´£æ‰§è¡Œæ›¿æ¢æ“ä½œï¼Œä¸æ”¯æŒæ ¼å¼åŒ–è¯­æ³•(ä¾‹å¦‚ï¼Œæ— æ³•æ§åˆ¶æµ®ç‚¹æ•°çš„ç²¾åº¦)ã€‚

ğŸ”¨ class string.Template(*template*)

- substitute(*mapping*, \*\**kwds*) # æ›¿æ¢å ä½ç¬¦
- safe_substitute(*mapping*, \*\**kwds*) # å®‰å…¨æ›¿æ¢å ä½ç¬¦
- template # æŸ¥çœ‹æˆ–ä¿®æ”¹å­—ç¬¦ä¸²æ¨¡æ¿

Template strings support `$`-based substitutions, using the following rules:

- `$$` is an escape; it is replaced with a single `$`.
- `$identifier` names a substitution placeholder matching a mapping key of`"identifier"`. By default, `"identifier"` is restricted to any case-insensitive ASCII alphanumeric string (including underscores) that starts with an underscore or ASCII letter. The first non-identifier character after the `$` character terminates this placeholder specification.
- `${identifier}` is equivalent to `$identifier`. It is required when valid identifier characters follow the placeholder but are not part of the placeholder, such as `"${noun}ification"`.

ç¤ºä¾‹ - å±•ç¤ºåˆçº§ç”¨æ³•ï¼Œ`$var` æ˜¯å ä½ç¬¦

```python
>>> from string import Template
>>> values = {'var': 'foo'}
>>> t=Template("""\
Escape          : $$
Variable        : $var
Variable in text: ${var}iable""")
>>> print(t.substitute(values))
Escape          : $
Variable        : foo
Variable in text: fooiable
>>> # å¦‚æœåªæä¾›äº†éƒ¨åˆ†å…³é”®å­—å‚æ•°ï¼Œå¯åˆ©ç”¨safe_substituteé¿å…KeyError
>>> print(t.safe_substitute(dict()))
Escape          : $
Variable        : $var
Variable in text: ${var}iable
```

## 6. format()

ğŸ”¨ format(*value*[, *format_spec*])

> æœ‰å…³ format() å‡½æ•°çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·é˜…è¯»ç¬”è®°ã€format.mdã€ï¼Œè¿™é‡Œä»…æä¾›ç®€è¦æ¦‚è¿°ã€‚

è¯¥å‡½æ•°ä¼šå°† *value* æŒ‰ç…§ *format_spec* ä¸­ç»™å‡ºçš„è§„åˆ™è¿›è¡Œæ ¼å¼åŒ–ã€‚*format_spec* çš„å«ä¹‰ä¾èµ–äº *value* çš„ç±»å‹ï¼Œä¸åŒç±»å‹çš„ *value* ä¼šä½¿ *format_spec* æ‹¥æœ‰ä¸åŒçš„è§£é‡Šã€‚

å¤§å¤šæ•°å†…ç½®ç±»å‹éƒ½éµå¾ªåŒä¸€å¥—æ ‡å‡†æ ¼å¼åŒ–è¯­æ³•ï¼š[Format Specification Mini-Language](https://docs.python.org/3.7/library/string.html#formatspec) (è¯¦è§ç¬”è®°ã€string â€” Common string operations.mdã€-> "Format Specification Mini-Language")ã€‚å› æ­¤ï¼Œå¦‚æœ *value* æ˜¯å†…ç½®ç±»å‹ï¼Œé‚£ä¹ˆä¼ é€’ç»™ *format_spec* çš„å®å‚å€¼éœ€å®‰è£… Format Specification Mini-Language ä¸­è§„å®šçš„æ ¼å¼ç¼–å†™ï¼š

```
format_spec     ::=  [[fill]align][sign][#][0][width][grouping_option][.precision][type]
fill            ::=  <any character>
align           ::=  "<" | ">" | "=" | "^"
sign            ::=  "+" | "-" | " "
width           ::=  digit+
grouping_option ::=  "_" | ","
precision       ::=  digit+
type            ::=  "b" | "c" | "d" | "e" | "E" | "f" | "F" | "g" | "G" | "n" | "o" | "s" | "x" | "X" | "%"
```

ç¤ºä¾‹ - å±•ç¤º `format()` å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ï¼š

```python
>>> format(97,'c') # å°†æ•´æ•°è½¬æ¢ä¸ºå¯¹åº”çš„Unicodeå­—ç¬¦
'a'
>>> format(11,'#x') # ä»¥16è¿›åˆ¶"æ›¿ä»£å½¢å¼"æ˜¾ç¤ºæ•´æ•°
'0xb'
>>> format(314159267,'e') #ç§‘å­¦è®¡æ•°æ³•ï¼Œé»˜è®¤ä¿ç•™6ä½å°æ•°
'3.141593e+08'
>>> format(3.14e+1000000,'F')  #å°æ•°ç‚¹è®¡æ•°æ³•ï¼Œæ— ç©·å¤§è½¬æ¢æˆå¤§å°å­—æ¯
'INF'
```

*format_spec* çš„é»˜è®¤å€¼æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œé€šå¸¸ä¸è°ƒç”¨ `str(value)` çš„æ•ˆæœç›¸åŒã€‚

```python
>>> format([1,2,3])
'[1, 2, 3]'
>>> str([1,2,3])
'[1, 2, 3]'
```

## 7. æœ¯è¯­

- æ ¼å¼åŒ–è¯´æ˜ç¬¦ (format specifier) ï¼šç”¨äºè¯´æ˜æ ¼å¼åŒ–æ–¹å¼çš„å­—æ®µï¼Œè¯·å‚è€ƒ [format specifier mini-language](https://docs.python.org/3.7/library/string.html#formatspec)


